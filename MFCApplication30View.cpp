// MFCApplication30View.cpp : реализация класса CMFCApplication30View
//

#include "stdafx.h"
// SHARED_HANDLERS можно определить в обработчиках фильтров просмотра реализации проекта ATL, эскизов
// и поиска; позволяет совместно использовать код документа в данным проекте.
#ifndef SHARED_HANDLERS
#include "MFCApplication30.h"
#endif

#include "MFCApplication30Doc.h"
#include "MFCApplication30View.h"
#include "MainFrm.h"
//#include "GenList.h"
#include "Data.h"
#ifdef _DEBUG
#define new DEBUG_NEW
#endif

// CMFCApplication30View

extern CData db;

IMPLEMENT_DYNCREATE(CMFCApplication30View, CView)

BEGIN_MESSAGE_MAP(CMFCApplication30View, CView)
	// Стандартные команды печати
	ON_COMMAND(ID_FILE_PRINT, &CView::OnFilePrint)
	ON_COMMAND(ID_FILE_PRINT_DIRECT, &CView::OnFilePrint)
	ON_COMMAND(ID_FILE_PRINT_PREVIEW, &CView::OnFilePrintPreview)
	ON_MESSAGE(WM_UPDATELISTVIEW, &CMFCApplication30View::OnUpdatelistview)
END_MESSAGE_MAP()

// создание/уничтожение CMFCApplication30View

CMFCApplication30View::CMFCApplication30View()
{
	// TODO: добавьте код создания
	//CMainFrame* pFrm=(CMainFrame*) theApp.m_pMainWnd;
	//CString s;
	//s.Format(L"2017");
	//pFrm->m_wndStatusBar.SetPaneText(pFrm->m_wndStatusBar.CommandToIndex(ID_INDICATOR_CURRENT_YEAR),L"2017");
}

CMFCApplication30View::~CMFCApplication30View()
{
}

BOOL CMFCApplication30View::PreCreateWindow(CREATESTRUCT& cs)
{
	// TODO: изменить класс Window или стили посредством изменения
	//  CREATESTRUCT cs
	//cs.y=500;
	//cs.x=0;
	return CView::PreCreateWindow(cs);
}

// рисование CMFCApplication30View

void CMFCApplication30View::OnDraw(CDC* /*pDC*/)
{
	CMFCApplication30Doc* pDoc = GetDocument();
	ASSERT_VALID(pDoc);
	if (!pDoc)
		return;

	// TODO: добавьте здесь код отрисовки для собственных данных
}


// печать CMFCApplication30View

BOOL CMFCApplication30View::OnPreparePrinting(CPrintInfo* pInfo)
{
	// подготовка по умолчанию
	return DoPreparePrinting(pInfo);
}

void CMFCApplication30View::OnBeginPrinting(CDC* /*pDC*/, CPrintInfo* /*pInfo*/)
{
	// TODO: добавьте дополнительную инициализацию перед печатью
}

void CMFCApplication30View::OnEndPrinting(CDC* /*pDC*/, CPrintInfo* /*pInfo*/)
{
	// TODO: добавьте очистку после печати
}


// диагностика CMFCApplication30View

#ifdef _DEBUG
void CMFCApplication30View::AssertValid() const
{
	CView::AssertValid();
}

void CMFCApplication30View::Dump(CDumpContext& dc) const
{
	CView::Dump(dc);
}

CMFCApplication30Doc* CMFCApplication30View::GetDocument() const // встроена неотлаженная версия
{
	ASSERT(m_pDocument->IsKindOf(RUNTIME_CLASS(CMFCApplication30Doc)));
	return (CMFCApplication30Doc*)m_pDocument;
}
#endif //_DEBUG


// обработчики сообщений CMFCApplication30View


afx_msg LRESULT CMFCApplication30View::OnUpdatelistview(WPARAM wParam, LPARAM lParam)
{
	return 0;
}

int CMFCApplication30View::defineResourceType(void)
{
	int resource = 0;
	if(StrCmp(db.m_szTypeResource,L"ПРИРОДНЫЙ ГАЗ")==0)
	{
		resource = 2;
	}
	else
	if(StrCmp(db.m_szTypeResource,L"ЭЛЕКТРОЭНЕРГИЯ")==0)
	{
		resource = 3;
	}
	else
	if(StrCmp(db.m_szTypeResource,L"ТЕПЛОВАЯ ЭНЕРГИЯ")==0)
	{
		resource = 4;
	}
	return resource;
}



void CMFCApplication30View::UpdView(void)
{
	
	CMainFrame* pFrm=(CMainFrame*) theApp.m_pMainWnd;
	CGenList* plist=(CGenList*) pFrm->m_wndSplitter.GetPane(0,1);
	
	pFrm=NULL;
	delete pFrm;

//	CRetQuery crq;

	int id_func=0;

	while(plist->GetListCtrl().DeleteColumn(0));

	CString str; str.Format(L"Пусто");
	
	CString total[6];
	for(int i=0;i<6;i++) {total[i]=L"0";}

	//РЕЖИМ ОБНОВЛЕНИЯ
	if(StrCmp(db.m_szGenAdd,L"0")!=0)
	{
		id_func=1;//Выбран один из отчетов 1

		if(StrCmp(db.m_szYear,L"0")!=0)
		{
			id_func+=10; //10 Выбран год	
			
			//AfxMessageBox(L"!!!");

			str.Format(
			L"SELECT SUM(PEF) AS PEF2, SUM(PEC) AS PEC2, SUM(PCOST) AS PCOST2, SUM(PTEC) AS PTEC2, SUM(PTCOST) AS PTCOST2, SUM(PTTIME) AS PTTIME2 FROM "
			L"(SELECT R2.PEF, R2.PEC, R2.PCOST, R2.PTEC+R2.PTYEC AS PTEC, R2.PTCOST+R2.PTYCOST AS PTCOST, R2.PTTIME+R2.PTYPTIME AS PTTIME FROM "
			L"(SELECT R1.EVENT, SUM(PI2.CURTIME) AS PTYPTIME, PEF,SUM(PI2.ECONOMY) AS PTYEC, PEC, SUM(PI2.CURCOSTS) AS PTYCOST, PCOST, PTEC, PTCOST, PTTIME FROM "
			L"("
			L"SELECT T1.EVENT, T1.SSAV AS PEF, T1.SEC AS PEC, T1.SCOST AS PCOST, EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALPLANTIME AS PTTIME FROM "
			L"(SELECT "
			L"PE.EVENT, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
			L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
			L"(SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT "
			L"WHERE PE.NYEAR=%s AND PE.ID_EVENT_TYPE=-TYPE- AND PE.GENADD=%d GROUP BY PE.EVENT) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME"
			L") AS R1 INNER JOIN PLAN_INFO AS PI2 ON R1.EVENT=PI2.EVENT WHERE PI2.NYEAR<=%s "
			L"GROUP BY R1.EVENT, PEF, PEC, PCOST, PTEC, PTCOST, PTTIME) AS R2) AS R3",
			db.m_szYear,
			db.m_szYear,
			(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
			db.m_szYear);

			//AfxMessageBox(L"->>>");

			/*str.Format(
			L"SELECT SUM(T1.SSAV), SUM(T1.SEC), SUM(T1.SCOST), SUM(EVS.TOTALPLANECONOMY), SUM(EVS.TOTALPLANCOSTS), SUM(EVS.TOTALPLANTIME) FROM "
			L"(SELECT " 
			L"PE.EVENT, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
			L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
			L"(SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT "
			L"WHERE PE.NYEAR=%s AND PE.ID_EVENT_TYPE=-TYPE- AND PE.GENADD=%d GROUP BY PE.EVENT) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME",
			db.m_szYear,
			db.m_szYear,
			(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1));*/


			if(StrCmp(db.m_szQuart,L"0")!=0)
			{
				id_func+=10;
				
				str.Format(
				L"SELECT SUM(PEF) AS PEF2, SUM(PEC) AS PEC2, SUM(PCOST) AS PCOST2, SUM(PTEC) AS PTEC2, SUM(PTCOST) AS PTCOST2, SUM(PTTIME) AS PTTIME2 FROM "
				L"(SELECT R2.PEF, R2.PEC, R2.PCOST, R2.PTEC+R2.PTYEC AS PTEC, R2.PTCOST+R2.PTYCOST AS PTCOST, R2.PTTIME+R2.PTYPTIME AS PTTIME FROM "
				L"(SELECT R1.EVENT, SUM(PI2.CURTIME) AS PTYPTIME, PEF,SUM(PI2.ECONOMY) AS PTYEC, PEC, SUM(PI2.CURCOSTS) AS PTYCOST, PCOST, PTEC, PTCOST, PTTIME FROM "
				L"("
				L"SELECT T1.EVENT, T1.SSAV AS PEF, T1.SEC AS PEC, T1.SCOST AS PCOST, EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALPLANTIME AS PTTIME FROM "
				L"(SELECT "
				L"PE.EVENT, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
				L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT "
				L"WHERE PE.NYEAR=%s AND PE.ID_EVENT_TYPE=-TYPE- AND PE.GENADD=%d GROUP BY PE.EVENT) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME"
				L") AS R1 INNER JOIN PLAN_INFO AS PI2 ON R1.EVENT=PI2.EVENT WHERE PI2.NYEAR<%s OR (PI2.NYEAR=%s AND PI2.NQUART<=%d) "
				L"GROUP BY R1.EVENT, PEF, PEC, PCOST, PTEC, PTCOST, PTTIME) AS R2) AS R3",
				db.m_szYear,
				db.defineQuart(),
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear,
				db.m_szYear,
				db.defineQuart());
				//AfxMessageBox(str);

				/*
				str.Format(sssss
				L"SELECT SUM(T1.SSAV), SUM(T1.SEC), SUM(T1.SCOST), SUM(EVS.TOTALPLANECONOMY), SUM(EVS.TOTALPLANCOSTS) FROM "
				L"(SELECT " 
				L"PE.EVENT, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
				L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT "
				L"WHERE PE.NYEAR=%s AND PE.ID_EVENT_TYPE=-TYPE- AND PE.GENADD=%d GROUP BY PE.EVENT) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME ",
				db.m_szYear,
				db.defineQuart(),
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1));*/

				/*str.Format(
				L"SELECT R2.PEF, R2.PEC, R2.PCOST, R2.PTEC+R2.PTYEC AS PTEC, R2.PTCOST+R2.PTYCOST AS PTCOST, R2.PTTIME+R2.PTYPTIME AS PTTIME FROM "
				L"(SELECT R1.EVENT, R1.MESUAR, R1.PEF AS PEF, R1.PEC AS PEC, R1.PCOST AS PCOST, R1.PTEC AS PTEC, SUM(PI2.ECONOMY) AS PTYEC, R1.PTCOST, SUM(PI2.CURCOSTS) AS PTYCOST, R1.PTTIME, "
				L"SUM(PI2.CURTIME) AS PTYPTIME FROM "
				L"("
				L"SELECT T1.EVENT, T1.MESUAR, T1.SSAV AS PEF, T1.SEC AS PEC, T1.SCOST AS PCOST, EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALPLANTIME AS PTTIME FROM "
				L"(SELECT "
				L"PE.EVENT, PI.MESUAR, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
				L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT "
				L"WHERE PE.NYEAR=%s AND PE.ID_EVENT_TYPE=-TYPE- AND PE.GENADD=%d GROUP BY PE.EVENT, PI.MESUAR) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME"
				L") AS R1 INNER JOIN PLAN_INFO AS PI2 ON R1.EVENT=PI2.EVENT WHERE PI2.NYEAR<%s OR (PI2.NYEAR=%s AND PI2.NQUART<=%d) "
				L"GROUP BY R1.EVENT, R1.MESUAR, PEF, PEC, PCOST, PTEC, PTCOST, PTTIME) AS R2",
				db.m_szYear,
				db.defineQuart(),
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear,
				db.m_szYear,
				db.defineQuart());*/

				/*str.Format(
					L"SELECT R2.PEF, R2.PEC, R2.PCOST, R2.PTEC+R2.PTYEC AS PTEC, R2.PTCOST+R2.PTYCOST AS PTCOST, R2.PTTIME+R2.PTYPTIME AS PTTIME FROM "
					L"(SELECT R1.EVENT, SUM(PI2.CURTIME) AS PTYPTIME, PEF,SUM(PI2.ECONOMY) AS PTYEC, PEC, SUM(PI2.CURCOSTS) AS PTYCOST, PCOST, PTEC, PTCOST, PTTIME FROM "
					L"("
					L"SELECT T1.EVENT, T1.SSAV AS PEF, T1.SEC AS PEC, T1.SCOST AS PCOST, EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALPLANTIME AS PTTIME FROM "
					L"(SELECT "
					L"PE.EVENT, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
					L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					L"(SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT "
					L"WHERE PE.NYEAR=%s AND PE.ID_EVENT_TYPE=-TYPE- AND PE.GENADD=%d GROUP BY PE.EVENT) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME"
					L") AS R1 INNER JOIN PLAN_INFO AS PI2 ON R1.EVENT=PI2.EVENT WHERE PI2.NYEAR<%s OR (PI2.NYEAR=%s AND PI2.NQUART<=%d) "
					L"GROUP BY R1.EVENT, PEF, PEC, PCOST, PTEC, PTCOST, PTTIME) AS R2",
					db.m_szYear,
					db.defineQuart(),
					db.m_szYear,
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.m_szYear,
					db.m_szYear,
					db.defineQuart());*/
			}

			if(db.m_iStatus==FACT)
			{
				//AfxMessageBox(L"if(db.m_iStatus==FACT)");
				str.Format(
				L"SELECT "
				L"SUM(PEF) AS PEF2, "
				L"SUM(FEF) AS FEF2, " 
				L"SUM(FEC) AS FEC2, " 
				L"SUM(PCOST) AS PCOST2, " 
				L"SUM(FCOST) AS FCOST2, " 
				L"SUM(PTIME2) AS PTIME3, " 
				L"SUM(FTIME2) AS FTIME3, " 
				L"SUM(PTEC2) AS PTEC3, " 
				L"SUM(FTEC2) AS FTEC3, " 
				L"SUM(PTCOST2) AS PTCOST3, " 
				L"SUM(FTCOST2) AS FTCOST3, " 
				L"SUM(PTTIME2) AS PTTIME3, " 
				L"SUM(FTTIME2) AS FTTIME3 "
				L"FROM (SELECT "
				L"PEF,"
				L"FEF,"
				L"FEC,"
				L"PCOST,"
				L"FCOST,"
				L"PTIME AS PTIME2," 
				L"FTIME AS FTIME2," 
				L"PTEC+ADDPEC AS PTEC2," 
				L"FTEC+ADDFEC AS FTEC2,"
				L"PTCOST+ADDPCOST AS PTCOST2," 
				L"FTCOST+ADDFCOST AS FTCOST2," 
				L"PTTIME+ADDPTIME AS PTTIME2," 
				L"FTTIME+ADDFTIME AS FTTIME2 " 
				L"FROM "
				L"(SELECT  PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST,"
				L"SUM(FI2.SAVEDS) AS ADDFEF, SUM(FI2.ECONOMY) AS ADDFEC, SUM(FI2.CURTIME) AS ADDFTIME, SUM(FI2.CURCOSTS) AS ADDFCOST "
				L"FROM "
				L"(SELECT R4.EVENT, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, SUM(PI2.SAVEDS) AS ADDPEF, SUM(PI2.ECONOMY) AS ADDPEC, SUM(PI2.CURTIME) AS ADDPTIME, SUM(CURCOSTS) AS ADDPCOST FROM "
				L"(SELECT EVENT, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME FROM "
				L"(SELECT R4.EVENT, R4.PEF AS PEF, R4.FEF AS FEF, R4.FEC AS FEC, R4.PCOST AS PCOST, R4.FCOST AS FCOST, R4.PTIME AS PTIME, R4.FTIME AS FTIME,"
				L"EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALFACTCONOMY AS FTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALFACTCOSTS AS FTCOST, EVS.TOTALPLANTIME AS PTTIME,"
				L"EVS.TOTALFACTTIME AS FTTIME "
				L"FROM "
				L"(SELECT R1.EVENT, R3.ID_EVENT_TYPE, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME, R3.PEC "
				L"FROM "
				L"(SELECT R2.ID_EVENT_TYPE, R1.EVENT, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R1.PEC) AS PEC, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R1.PTIME) AS PTIME, SUM(R2.FTIME) AS FTIME FROM "
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.ECONOMY) AS PEC, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME, ECONOMY FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- AND PE.NYEAR=%s GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R1 "
				L"INNER JOIN "
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- AND PE.NYEAR=2018 GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
				L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE, R1.EVENT) R3 "
				L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE) AS R4 INNER JOIN EVENTS AS EVS ON R4.EVENT=EVS.EVENT_NAME)) AS R4 INNER JOIN PLAN_INFO AS PI2 ON PI2.EVENT=R4.EVENT "
				L"WHERE PI2.NYEAR<=%s "
				L"GROUP BY R4.EVENT, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME) AS R5 INNER JOIN FACT_INFO AS FI2 ON R5.EVENT=FI2.EVENT WHERE FI2.NYEAR<=%s "
				L"GROUP BY PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST)) AS R6",
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear,
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear,
				db.m_szYear,
				db.m_szYear);

				//AfxMessageBox(str);

				/*str.Format(
				L"SELECT SUM(PEF) AS PEF2, SUM(FEF) AS FEF2, SUM(FEC) AS FEC2, SUM(PCOST) AS PCOST2, SUM(FCOST) AS FCOST2, SUM(PTIME) AS PTIME2, SUM(FTIME) AS FTIME2, SUM(PTEC) AS PTEC2, SUM(FTEC) AS FTEC2, SUM(PTCOST) AS PTCOST2, "
				L"SUM(FTCOST) AS FTCOST2, SUM(PTTIME) AS PTTIME2, SUM(FTTIME) AS FTTIME2 FROM "
				L"(SELECT ID_EVENT_TYPE, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME FROM "
				L"(SELECT R4.ID_EVENT_TYPE, R4.PEF AS PEF, R4.FEF AS FEF, R4.FEC AS FEC, R4.PCOST AS PCOST, R4.FCOST AS FCOST, R4.PTIME AS PTIME, R4.FTIME AS FTIME,"				
				L"EVS.TOTALPLANECONOMY+R4.PEC AS PTEC, EVS.TOTALFACTCONOMY+R4.FEC AS FTEC, EVS.TOTALPLANCOSTS+R4.PCOST AS PTCOST, EVS.TOTALFACTCOSTS+R4.FCOST AS FTCOST, EVS.TOTALPLANTIME+R4.PTIME AS PTTIME," 
				L"EVS.TOTALFACTTIME+R4.FTIME AS FTTIME "
				L"FROM "
				L"(SELECT R1.EVENT, R3.ID_EVENT_TYPE, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME, R3.PEC "
				L"FROM "
				L"(SELECT R2.ID_EVENT_TYPE, R1.EVENT, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R1.PEC) AS PEC, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R1.PTIME) AS PTIME, SUM(R2.FTIME) AS FTIME FROM "	
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.ECONOMY) AS PEC, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME, ECONOMY FROM PLAN_INFO WHERE NYEAR=%s)  AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R1 "
				L"INNER JOIN "
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
				L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE, R1.EVENT) R3 "
				L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE) AS R4 INNER JOIN EVENTS AS EVS ON R4.EVENT=EVS.EVENT_NAME) AS R5) AS R6 "
				L"GROUP BY R6.ID_EVENT_TYPE",
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1));*/
				/*str.Format(
				L"SELECT SUM(PEF) AS PEF2, SUM(PEC) AS PEC2, SUM(PCOST) AS PCOST2, SUM(PTEC) AS PTEC2, SUM(PTCOST) AS PTCOST2, SUM(PTTIME) AS PTTIME2 FROM "
				L"(SELECT R2.PEF, R2.PEC, R2.PCOST, R2.PTEC+R2.PTYEC AS PTEC, R2.PTCOST+R2.PTYCOST AS PTCOST, R2.PTTIME+R2.PTYPTIME AS PTTIME FROM "
				L"(SELECT R1.EVENT, SUM(PI2.CURTIME) AS PTYPTIME, PEF,SUM(PI2.ECONOMY) AS PTYEC, PEC, SUM(PI2.CURCOSTS) AS PTYCOST, PCOST, PTEC, PTCOST, PTTIME FROM "
				L"("
				L"SELECT T1.EVENT, T1.SSAV AS PEF, T1.SEC AS PEC, T1.SCOST AS PCOST, EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALPLANTIME AS PTTIME FROM "
				L"(SELECT "
				L"PE.EVENT, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
				L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT "
				L"WHERE PE.NYEAR=%s AND PE.ID_EVENT_TYPE=-TYPE- AND PE.GENADD=%d GROUP BY PE.EVENT) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME"
				L") AS R1 INNER JOIN PLAN_INFO AS PI2 ON R1.EVENT=PI2.EVENT WHERE PI2.NYEAR<=%s "
				L"GROUP BY R1.EVENT, PEF, PEC, PCOST, PTEC, PTCOST, PTTIME) AS R2) AS R3",
				db.m_szYear,
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear);*/

				/*str.Format(
				L"SELECT SUM(R4.PEF) AS PEF, SUM(R4.FEF) AS FEF, SUM(R4.FEC) AS FEC, SUM(R4.PCOST) AS PCOST, SUM(R4.FCOST) AS FCOST, SUM(R4.PTIME) AS PTIME, SUM(R4.FTIME) AS FTIME,"
				L"EVS.TOTALPLANECONOMY, EVS.TOTALFACTCONOMY, EVS.TOTALPLANCOSTS, EVS.TOTALFACTCOSTS, EVS.TOTALPLANTIME, EVS.TOTALFACTTIME "
				L"FROM "
				L"(SELECT R1.EVENT, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME "
				L"FROM "
				L"(SELECT R2.ID_EVENT_TYPE, R1.EVENT, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R1.PTIME) AS PTIME, SUM(R2.FTIME) AS FTIME FROM "
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s)  AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R1 "
				L"INNER JOIN "
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
				L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE, R1.EVENT) R3 "
				L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE) AS R4 INNER JOIN EVENTS AS EVS ON R4.EVENT=EVS.EVENT_NAME "
				L"GROUP BY EVS.TOTALPLANECONOMY, EVS.TOTALFACTCONOMY, EVS.TOTALPLANCOSTS, EVS.TOTALFACTCOSTS, EVS.TOTALPLANTIME, EVS.TOTALFACTTIME",
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1));*/
				
				/*
				//Текущий запрос
				str.Format(
				L"SELECT R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST "
				L"FROM "
				L"(SELECT R2.ID_EVENT_TYPE, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST FROM "
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.CURCOSTS) AS COST FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS FROM PLAN_INFO WHERE NYEAR=%s)  AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R1 "
				L"INNER JOIN "
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY FROM FACT_INFO WHERE NYEAR=%s)  AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
				L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE) R3 "
				L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE",
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1));*/
				
				if(StrCmp(db.m_szQuart,L"0")!=0)
				{

					str.Format(
					L"SELECT "
					L"SUM(PEF) AS PEF2, "
					L"SUM(FEF) AS FEF2, " 
					L"SUM(FEC) AS FEC2, " 
					L"SUM(PCOST) AS PCOST2, " 
					L"SUM(FCOST) AS FCOST2, " 
					L"SUM(PTIME2) AS PTIME3, " 
					L"SUM(FTIME2) AS FTIME3, " 
					L"SUM(PTEC2) AS PTEC3, " 
					L"SUM(FTEC2) AS FTEC3, " 
					L"SUM(PTCOST2) AS PTCOST3, " 
					L"SUM(FTCOST2) AS FTCOST3, " 
					L"SUM(PTTIME2) AS PTTIME3, " 
					L"SUM(FTTIME2) AS FTTIME3 "
					L"FROM (SELECT "
					L"PEF,"
					L"FEF,"
					L"FEC,"
					L"PCOST,"
					L"FCOST,"
					L"PTIME AS PTIME2," 
					L"FTIME AS FTIME2," 
					L"PTEC+ADDPEC AS PTEC2," 
					L"FTEC+ADDFEC AS FTEC2,"
					L"PTCOST+ADDPCOST AS PTCOST2," 
					L"FTCOST+ADDFCOST AS FTCOST2," 
					L"PTTIME+ADDPTIME AS PTTIME2," 
					L"FTTIME+ADDFTIME AS FTTIME2 " 
					L"FROM "
					L"(SELECT  PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST,"
					L"SUM(FI2.SAVEDS) AS ADDFEF, SUM(FI2.ECONOMY) AS ADDFEC, SUM(FI2.CURTIME) AS ADDFTIME, SUM(FI2.CURCOSTS) AS ADDFCOST "
					L"FROM "
					L"(SELECT R4.EVENT, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, SUM(PI2.SAVEDS) AS ADDPEF, SUM(PI2.ECONOMY) AS ADDPEC, SUM(PI2.CURTIME) AS ADDPTIME, SUM(CURCOSTS) AS ADDPCOST FROM "
					L"(SELECT EVENT, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME FROM "
					L"(SELECT R4.EVENT, R4.PEF AS PEF, R4.FEF AS FEF, R4.FEC AS FEC, R4.PCOST AS PCOST, R4.FCOST AS FCOST, R4.PTIME AS PTIME, R4.FTIME AS FTIME,"
					L"EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALFACTCONOMY AS FTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALFACTCOSTS AS FTCOST, EVS.TOTALPLANTIME AS PTTIME,"
					L"EVS.TOTALFACTTIME AS FTTIME "
					L"FROM "
					L"(SELECT R1.EVENT, R3.ID_EVENT_TYPE, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME, R3.PEC "
					L"FROM "
					L"(SELECT R2.ID_EVENT_TYPE, R1.EVENT, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R1.PEC) AS PEC, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R1.PTIME) AS PTIME, SUM(R2.FTIME) AS FTIME FROM "
					L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.ECONOMY) AS PEC, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME, ECONOMY FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND PE.NYEAR=%s AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R1 "
					L"INNER JOIN "
					L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND PE.NYEAR=%s AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
					L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE, R1.EVENT) R3 "
					L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE) AS R4 INNER JOIN EVENTS AS EVS ON R4.EVENT=EVS.EVENT_NAME)) AS R4 INNER JOIN PLAN_INFO AS PI2 ON PI2.EVENT=R4.EVENT "
					L"WHERE PI2.NYEAR<%s OR (PI2.NYEAR=%s AND PI2.NQUART<=%d) "
					L"GROUP BY R4.EVENT, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME) AS R5 INNER JOIN FACT_INFO AS FI2 ON R5.EVENT=FI2.EVENT WHERE FI2.NYEAR<%s OR (FI2.NYEAR=%s AND FI2.NQUART<=%d) "
					L"GROUP BY PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST)) AS R6",
					db.m_szYear,
					db.defineQuart(),
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.m_szYear,
					db.m_szYear,
					db.defineQuart(),
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.m_szYear,
					db.m_szYear,
					db.m_szYear,
					db.defineQuart(),
					db.m_szYear,
					db.m_szYear,
					db.defineQuart());

				//AfxMessageBox(str);

				/*str.Format(
				L"SELECT SUM(PEF) AS PEF2, SUM(FEF) AS FEF2, SUM(FEC) AS FEC2, SUM(PCOST) AS PCOST2, SUM(FCOST) AS FCOST2, SUM(PTIME) AS PTIME2, SUM(FTIME) AS FTIME2, SUM(PTEC) AS PTEC2, SUM(FTEC) AS FTEC2, SUM(PTCOST) AS PTCOST2, "
				L"SUM(FTCOST) AS FTCOST2, SUM(PTTIME) AS PTTIME2, SUM(FTTIME) AS FTTIME2 FROM "
				L"(SELECT ID_EVENT_TYPE, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME FROM "
				L"(SELECT R4.ID_EVENT_TYPE, R4.PEF AS PEF, R4.FEF AS FEF, R4.FEC AS FEC, R4.PCOST AS PCOST, R4.FCOST AS FCOST, R4.PTIME AS PTIME, R4.FTIME AS FTIME,"				
				L"EVS.TOTALPLANECONOMY+R4.PEC AS PTEC, EVS.TOTALFACTCONOMY+R4.FEC AS FTEC, EVS.TOTALPLANCOSTS+R4.PCOST AS PTCOST, EVS.TOTALFACTCOSTS+R4.FCOST AS FTCOST, EVS.TOTALPLANTIME+R4.PTIME AS PTTIME," 
				L"EVS.TOTALFACTTIME+R4.FTIME AS FTTIME "
				L"FROM "
				L"(SELECT R1.EVENT, R3.ID_EVENT_TYPE, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME, R3.PEC "
				L"FROM "
				L"(SELECT R2.ID_EVENT_TYPE, R1.EVENT, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R1.PEC) AS PEC, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R1.PTIME) AS PTIME, SUM(R2.FTIME) AS FTIME FROM "	
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.ECONOMY) AS PEC, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME, ECONOMY FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d)  AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R1 "
				L"INNER JOIN "
				L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
				L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE, R1.EVENT) R3 "
				L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE) AS R4 INNER JOIN EVENTS AS EVS ON R4.EVENT=EVS.EVENT_NAME) AS R5) AS R6 "
				L"GROUP BY R6.ID_EVENT_TYPE",
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1));*/
					/*str.Format(
					L"SELECT R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME "
					L"FROM "
					L"(SELECT R2.ID_EVENT_TYPE, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R1.PTIME) AS PTIME, SUM(R2.FTIME) AS FTIME FROM "
					L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R1 "
					L"INNER JOIN "
					L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
					L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE) R3 "
					L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE",
					db.m_szYear,
					db.defineQuart(),
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.m_szYear,
					db.defineQuart(),
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1));*/

					//AfxMessageBox(str);

					if(StrCmp(db.m_szMonth,L"0")!=0)
					{
						id_func+=10;

						/*str.Format(
						L"SELECT "
						L"SUM(PEF) AS PEF2, "
						L"SUM(FEF) AS FEF2, " 
						L"SUM(FEC) AS FEC2, " 
						L"SUM(PCOST) AS PCOST2, " 
						L"SUM(FCOST) AS FCOST2, " 
						L"SUM(PTIME2) AS PTIME3, " 
						L"SUM(FTIME2) AS FTIME3, " 
						L"SUM(PTEC2) AS PTEC3, " 
						L"SUM(FTEC2) AS FTEC3, " 
						L"SUM(PTCOST2) AS PTCOST3, " 
						L"SUM(FTCOST2) AS FTCOST3, " 
						L"SUM(PTTIME2) AS PTTIME3, " 
						L"SUM(FTTIME2) AS FTTIME3 "
						L"FROM (SELECT "
						L"PEF,"
						L"FEF,"
						L"FEC,"
						L"PCOST,"
						L"FCOST,"
						L"PTIME+ADDPTIME AS PTIME2," 
						L"FTIME+ADDFTIME AS FTIME2," 
						L"PTEC+ADDPEC AS PTEC2," 
						L"FTEC+ADDFEC AS FTEC2,"
						L"PTCOST+ADDPCOST AS PTCOST2," 
						L"FTCOST+ADDFCOST AS FTCOST2," 
						L"PTTIME+ADDPTIME AS PTTIME2," 
						L"FTTIME+ADDFTIME AS FTTIME2 " 
						L"FROM "
						L"(SELECT  PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST,"
						L"SUM(FI2.SAVEDS) AS ADDFEF, SUM(FI2.ECONOMY) AS ADDFEC, SUM(FI2.CURTIME) AS ADDFTIME, SUM(FI2.CURCOSTS) AS ADDFCOST "
						L"FROM "
						L"(SELECT R4.EVENT, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, SUM(PI2.SAVEDS) AS ADDPEF, SUM(PI2.ECONOMY) AS ADDPEC, SUM(PI2.CURTIME) AS ADDPTIME, SUM(CURCOSTS) AS ADDPCOST FROM "
						L"(SELECT EVENT, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME FROM "
						L"(SELECT R4.EVENT, R4.PEF AS PEF, R4.FEF AS FEF, R4.FEC AS FEC, R4.PCOST AS PCOST, R4.FCOST AS FCOST, R4.PTIME AS PTIME, R4.FTIME AS FTIME,"
						L"EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALFACTCONOMY AS FTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALFACTCOSTS AS FTCOST, EVS.TOTALPLANTIME AS PTTIME,"
						L"EVS.TOTALFACTTIME AS FTTIME "
						L"FROM "
						L"(SELECT R1.EVENT, R3.ID_EVENT_TYPE, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME, R3.PEC "
						L"FROM "
						L"(SELECT R2.ID_EVENT_TYPE, R1.EVENT, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R1.PEC) AS PEC, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R1.PTIME) AS PTIME, SUM(R2.FTIME) AS FTIME FROM "
						L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.ECONOMY) AS PEC, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
						L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME, ECONOMY FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d AND NMONTH=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R1 "
						L"INNER JOIN "
						L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
						L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d AND NMONTH=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
						L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE, R1.EVENT) R3 "
						L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE) AS R4 INNER JOIN EVENTS AS EVS ON R4.EVENT=EVS.EVENT_NAME)) AS R4 INNER JOIN PLAN_INFO AS PI2 ON PI2.EVENT=R4.EVENT "
						L"WHERE PI2.NYEAR<%s OR (PI2.NYEAR=%s AND PI2.NQUART<=%d AND PI2.NMONTH<=%d) "
						L"GROUP BY R4.EVENT, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME) AS R5 INNER JOIN FACT_INFO AS FI2 ON R5.EVENT=FI2.EVENT WHERE FI2.NYEAR<%s OR (FI2.NYEAR=%s AND FI2.NQUART<=%d AND FI2.NMONTH<=%d) "
						L"GROUP BY PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST)) AS R6",
						db.m_szYear,
						db.defineQuart(),
						db.defineMonth(),
						(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
						db.m_szYear,
						db.defineQuart(),
						db.defineMonth(),
						(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
						db.m_szYear,
						db.m_szYear,
						db.defineQuart(),
						db.defineMonth(),
						db.m_szYear,
						db.m_szYear,
						db.defineQuart(),
						defineMonth());*/

						//AfxMessageBox(str);
						str.Format(
						L"SELECT R3.FEF, R3.FEC, R3.FCOST, R3.FTIME "
						L"FROM "
						L"(SELECT R2.ID_EVENT_TYPE, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R2.FTIME) AS FTIME FROM "
						L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
						L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R1 "
						L"INNER JOIN "
						L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
						L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d AND NMONTH=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=-TYPE- AND PE.NYEAR=%s GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
						L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE) R3 "
						L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE",
						db.m_szYear,
						db.defineQuart(),
						(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
						db.m_szYear,
						db.defineQuart(),
						db.defineMonth(),
						(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
						db.m_szYear);
						//AfxMessageBox(str);
					}
				}
			}

			if(StrCmp(db.m_szTypeResource,L"0")!=0)
			{
				id_func+=1; //2 выбран ресурс

				/*str.Format(
				L"SELECT R2.EVENT, R2.MESUAR, R2.PEF, R2.PEC, R2.PCOST, R2.PTIME, R2.PTEC+R2.PTYEC AS PTEC, R2.PTCOST+R2.PTYCOST AS PTCOST, R2.PTTIME+R2.PTYPTIME AS PTTIME "
				L"FROM (SELECT R1.EVENT, R1.MESUAR, SUM(PI2.CURTIME) AS PTYPTIME, PEF,SUM(PI2.ECONOMY) AS PTYEC, PEC, SUM(PI2.CURCOSTS) AS PTYCOST, PCOST, PTIME, PTEC, PTCOST, PTTIME FROM "
				L"("
				L"SELECT T1.EVENT, T1.MESUAR, T1.SSAV AS PEF, T1.SEC AS PEC, T1.SCOST AS PCOST, T1.STIME AS PTIME, EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALPLANTIME AS PTTIME FROM "
				L"(SELECT "
				L"PE.EVENT, PI.MESUAR, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
				L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT "
				L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.EVENT, PI.MESUAR) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME "
				L") AS R1 INNER JOIN PLAN_INFO AS PI2 ON R1.EVENT=PI2.EVENT WHERE PI2.NYEAR<=%s "
				L"GROUP BY R1.EVENT, R1.MESUAR, PEF, PEC, PCOST, PTIME, PTEC, PTCOST, PTTIME)  AS R2",
				db.m_szYear,
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.defineResourceType(),
				db.m_szYear);*/

				/*str.Format(
				L"SELECT R2.EVENT, R2.MESUAR, R2.PEF, R2.PEC, R2.PCOST, R2.PTIME, R2.PTEC+R2.PTYEC AS PTEC, R2.PTCOST+R2.PTYCOST AS PTCOST, R2.PTTIME+R2.PTYPTIME AS PTTIME FROM "
				L"(SELECT R1.EVENT, R1.MESUAR, SUM(PI2.CURTIME) AS PTYPTIME, PEF,SUM(PI2.ECONOMY) AS PTYEC, PEC, SUM(PI2.CURCOSTS) AS PTYCOST, PCOST, PTEC, PTIME, PTCOST, PTTIME FROM "
				L"("
				L"SELECT T1.EVENT, T1.MESUAR, T1.SSAV AS PEF, T1.SEC AS PEC, T1.SCOST AS PCOST, T1.STIME AS PTIME EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALPLANTIME AS PTTIME FROM "
				L"(SELECT "
				L"PE.EVENT, PI.MESUAR, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
				L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
				L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT "
				L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.EVENT, PI.MESUAR) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME"
				L") AS R1 INNER JOIN PLAN_INFO AS PI2 ON R1.EVENT=PI2.EVENT WHERE PI2.NYEAR<=%s "
				L"GROUP BY R1.EVENT, R1.MESUAR, PEF, PEC, PTIME, PCOST, PTEC, PTCOST, PTTIME) AS R2",
				db.m_szYear,
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.defineResourceType(),
				db.m_szYear);*/

					/*str.Format(
					L"SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS FROM "
					L"(SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME FROM "
					L"(SELECT PE.EVENT, PE.ID_EVENT_TYPE, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME FROM "
					L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT "
					L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.EVENT, PE.ID_EVENT_TYPE) AS T1 INNER JOIN EVENT_TYPES AS EVS "
					L"ON EVS.ID_EVENT_TYPE=T1.ID_EVENT_TYPE) T2 INNER JOIN EVENTS "
					L"ON EVENTS.EVENT_NAME=T2.EVENT ORDER BY SSAV DESC",
					db.m_szYear,
					db.m_szYear,
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.defineResourceType());*/
				str.Format(
				L"SELECT EVENT, MEUAR, SSAV, SEC, SCOST, STIME, TOTALPLANECONOMY+ADDPEC AS PTEC, TOTALPLANCOSTS+ADDPCOST AS PTCOST, TOTALPLANTIME+ADDPTIME AS PTTIME FROM "
				L"(SELECT R1.EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS, EVENTS.TOTALPLANTIME," 
				L"SUM(PI2.ECONOMY) AS ADDPEC,"
				L"SUM(PI2.CURCOSTS) AS ADDPCOST,"
				L"SUM(PI2.CURTIME) AS ADDPTIME "
				L"FROM "
				L"(SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS, EVENTS.TOTALPLANTIME FROM "
				L"(SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME FROM "
				L"(SELECT PE.EVENT, PE.ID_EVENT_TYPE, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME FROM "
				L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT "
				L"WHERE PE.GENADD=%d AND PE.NYEAR=%s AND PE.ID_EVENT_TYPE=%d GROUP BY PE.EVENT, PE.ID_EVENT_TYPE) AS T1 INNER JOIN EVENT_TYPES AS EVS "
				L"ON EVS.ID_EVENT_TYPE=T1.ID_EVENT_TYPE) T2 INNER JOIN EVENTS "
				L"ON EVENTS.EVENT_NAME=T2.EVENT ORDER BY SSAV DESC) R1 LEFT OUTER JOIN "
				L"(SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR<=%s) AS PI2 ON R1.EVENT=PI2.EVENT "
				L"GROUP BY R1.EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS, EVENTS.TOTALPLANTIME) ORDER BY SSAV DESC", /*LBL: 02032018 ДОБАВИЛ СОРТИРОВКУ ПО ПОЛЮ ЭФФЕКТ */
				db.m_szYear,
				(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
				db.m_szYear,
				db.defineResourceType(),
				db.m_szYear);
				

				if(StrCmp(db.m_szQuart,L"0")!=0)
				{
					str.Format(
					L"SELECT R2.EVENT, R2.MESUAR, R2.PEF, R2.PEC, R2.PCOST, R2.PTIME, R2.PTEC+R2.PTYEC AS PTEC, R2.PTCOST+R2.PTYCOST AS PTCOST, R2.PTTIME+R2.PTYPTIME AS PTTIME "
					L"FROM (SELECT R1.EVENT, R1.MESUAR, SUM(PI2.CURTIME) AS PTYPTIME, PEF,SUM(PI2.ECONOMY) AS PTYEC, PEC, SUM(PI2.CURCOSTS) AS PTYCOST, PCOST, PTIME, PTEC, PTCOST, PTTIME FROM "
					L"("
					L"SELECT T1.EVENT, T1.MESUAR, T1.SSAV AS PEF, T1.SEC AS PEC, T1.SCOST AS PCOST, T1.STIME AS PTIME, EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALPLANTIME AS PTTIME FROM "
					L"(SELECT "
					L"PE.EVENT, PI.MESUAR, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME "
					L"FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT "
					L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.EVENT, PI.MESUAR) T1 INNER JOIN EVENTS AS EVS ON T1.EVENT=EVS.EVENT_NAME "
					L") AS R1 INNER JOIN PLAN_INFO AS PI2 ON R1.EVENT=PI2.EVENT WHERE PI2.NYEAR<%s OR (PI2.NYEAR=%s AND PI2.NQUART<=%d) "
					L"GROUP BY R1.EVENT, R1.MESUAR, PEF, PEC, PCOST, PTIME, PTEC, PTCOST, PTTIME)  AS R2 ORDER BY R2.PEF DESC",
					db.m_szYear,
					db.defineQuart(),
					db.m_szYear,
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.defineResourceType(),
					db.m_szYear,
					db.m_szYear,
					db.defineQuart());

					//AfxMessageBox(str);

					/*str.Format(
					L"SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS FROM "
					L"(SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME FROM "
					L"(SELECT PE.EVENT, PE.ID_EVENT_TYPE, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME FROM "
					L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT "
					L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.EVENT, PE.ID_EVENT_TYPE) AS T1 INNER JOIN EVENT_TYPES AS EVS "
					L"ON EVS.ID_EVENT_TYPE=T1.ID_EVENT_TYPE) T2 INNER JOIN EVENTS "
					L"ON EVENTS.EVENT_NAME=T2.EVENT",
					db.m_szYear,
					db.defineQuart(),
					db.m_szYear,
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.defineResourceType());*/

					/*if(StrCmp(db.m_szMonth,L"0")!=0)
					{
						str.Format(
						L"SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS FROM "
						L"(SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME FROM "
						L"(SELECT PE.EVENT, PE.ID_EVENT_TYPE, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME FROM "
						L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d AND NMONTH=%d) AS PI ON PE.EVENT=PI.EVENT "
						L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.EVENT, PE.ID_EVENT_TYPE) AS T1 INNER JOIN EVENT_TYPES AS EVS "
						L"ON EVS.ID_EVENT_TYPE=T1.ID_EVENT_TYPE) T2 INNER JOIN EVENTS "
						L"ON EVENTS.EVENT_NAME=T2.EVENT",
						db.m_szYear,
						db.defineQuart(),
						db.defineMonth(),
						db.m_szYear,
						(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
						db.defineResourceType());
					}*/
				}

				if(db.m_iStatus==FACT)
				{
					/*str.Format(
					L"SELECT R3.EVENT, ET.MEUAR, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME FROM "
					L"(SELECT R1.ID_EVENT_TYPE, R1.EVENT, R1.PEF, R2.FEF, R2.FEC, R1.PCOST, R2.FCOST, R1.PTIME, R2.FTIME "
					L"FROM (SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.CURCOSTS) AS PCOST, SUM(PI.CURTIME) AS PTIME FROM "
					L"PLAN_EVENT AS PE LEFT OUTER JOIN "
					L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=%d "
					L"GROUP BY PE.ID_EVENT_TYPE, PE.EVENT)  AS R1 INNER JOIN "
					L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM "
					L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM FACT_INFO WHERE NYEAR=%s) AS PI "
					L"ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=%d GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) AS R2 ON R1.EVENT=R2.EVENT) AS R3 INNER JOIN "
					L"EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE",
					db.m_szYear,
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.defineResourceType(),
					db.m_szYear,
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.defineResourceType());*/
					str.Format(
					L"SELECT "
					L"EVENT,"
					L"MESUAR,"
					L"PEF,"
					L"FEF,"
					L"FEC,"
					L"PCOST,"
					L"FCOST,"
					L"PTIME+ADDPTIME AS PTIME2,"
					L"FTIME+ADDFTIME AS FTIME2,"
					L"PTEC+ADDPEC AS PTEC2,"
					L"FTEC+ADDFEC AS FTEC2,"
					L"PTCOST+ADDPCOST AS PTCOST2,"
					L"FTCOST+ADDFCOST AS FTCOST2,"
					L"PTTIME+ADDPTIME AS PTTIME2,"
					L"FTTIME+ADDFTIME AS FTTIME2 "
					L"FROM "
					L"(SELECT FI2.EVENT, R5.MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST,"
					L"SUM(FI2.SAVEDS) AS ADDFEF, SUM(FI2.ECONOMY) AS ADDFEC, SUM(FI2.CURTIME) AS ADDFTIME, SUM(FI2.CURCOSTS) AS ADDFCOST "
					L"FROM "
					L"(SELECT R4.EVENT, R4.MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, SUM(PI2.SAVEDS) AS ADDPEF, SUM(PI2.ECONOMY) AS ADDPEC, SUM(PI2.CURTIME) AS ADDPTIME, SUM(CURCOSTS) AS ADDPCOST FROM "
					L"(SELECT EVENT, MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME FROM "
					L"(SELECT R4.EVENT, R4.MESUAR, R4.PEF AS PEF, R4.FEF AS FEF, R4.FEC AS FEC, R4.PCOST AS PCOST, R4.FCOST AS FCOST, R4.PTIME AS PTIME, R4.FTIME AS FTIME,"
					L"EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALFACTCONOMY AS FTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALFACTCOSTS AS FTCOST, EVS.TOTALPLANTIME AS PTTIME,"
					L"EVS.TOTALFACTTIME AS FTTIME "
					L"FROM "
					L"(SELECT R1.EVENT, R1.MESUAR, R3.ID_EVENT_TYPE, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME, R3.PEC "
					L"FROM "
					L"(SELECT R2.ID_EVENT_TYPE, R1.EVENT, R1.MESUAR, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R1.PEC) AS PEC, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R1.PTIME) AS PTIME, SUM(R2.FTIME) AS FTIME FROM "
					L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, PI.MESUAR, SUM(PI.SAVEDS) AS PEF, SUM(PI.ECONOMY) AS PEC, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					L"(SELECT EVENT, MESUAR, SAVEDS, CURCOSTS, CURTIME, ECONOMY FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d AND PE.NYEAR=%s GROUP BY PE.ID_EVENT_TYPE, PE.EVENT, PI.MESUAR) R1 "
					L"INNER JOIN "
					L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND PE.NYEAR=%s GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
					L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE, R1.EVENT, R1.MESUAR) R3 "
					L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE) AS R4 INNER JOIN EVENTS AS EVS ON R4.EVENT=EVS.EVENT_NAME)) AS R4 INNER JOIN PLAN_INFO AS PI2 ON PI2.EVENT=R4.EVENT "
					L"WHERE PI2.NYEAR<=%d "
					L"GROUP BY R4.EVENT, R4.MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME) AS R5 INNER JOIN FACT_INFO AS FI2 ON R5.EVENT=FI2.EVENT WHERE FI2.NYEAR<=%s "
					L"GROUP BY FI2.EVENT, R5.MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST) ORDER BY PEF DESC",
					db.m_szYear,
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.defineResourceType(),
					db.m_szYear,
					db.m_szYear,
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.m_szYear,
					db.m_szYear,
					db.m_szYear);

					//AfxMessageBox(str);

					//str.Format(
					////L"SELECT "
					////L"SUM(PEF) AS PEF2, "
					////L"SUM(FEF) AS FEF2, " 
					////L"SUM(FEC) AS FEC2, " 
					////L"SUM(PCOST) AS PCOST2, " 
					////L"SUM(FCOST) AS FCOST2, " 
					////L"SUM(PTIME2) AS PTIME3, " 
					////L"SUM(FTIME2) AS FTIME3, " 
					////L"SUM(PTEC2) AS PTEC3, " 
					////L"SUM(FTEC2) AS FTEC3, " 
					////L"SUM(PTCOST2) AS PTCOST3, " 
					////L"SUM(FTCOST2) AS FTCOST3, " 
					////L"SUM(PTTIME2) AS PTTIME3, " 
					////L"SUM(FTTIME2) AS FTTIME3 "
					////L"FROM (SELECT "
					//L"SELECT "
					//L"R5.EVENT,"
					//L"R5.MESUAR,"
					//L"PEF,"
					//L"FEF,"
					//L"FEC,"
					//L"PCOST,"
					//L"FCOST,"
					//L"PTIME+ADDPTIME AS PTIME2," 
					//L"FTIME+ADDFTIME AS FTIME2," 
					//L"PTEC+ADDPEC AS PTEC2," 
					//L"FTEC+ADDFEC AS FTEC2,"
					//L"PTCOST+ADDPCOST AS PTCOST2," 
					//L"FTCOST+ADDFCOST AS FTCOST2," 
					//L"PTTIME+ADDPTIME AS PTTIME2," 
					//L"FTTIME+ADDFTIME AS FTTIME2 " 
					//L"FROM "
					//L"(SELECT FI2.EVENT, FI2.MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST,"
					//L"SUM(FI2.SAVEDS) AS ADDFEF, SUM(FI2.ECONOMY) AS ADDFEC, SUM(FI2.CURTIME) AS ADDFTIME, SUM(FI2.CURCOSTS) AS ADDFCOST "
					//L"FROM "
					//L"(SELECT R4.EVENT, R4.MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, SUM(PI2.SAVEDS) AS ADDPEF, SUM(PI2.ECONOMY) AS ADDPEC, SUM(PI2.CURTIME) AS ADDPTIME, SUM(CURCOSTS) AS ADDPCOST FROM "
					//L"(SELECT EVENT, MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME FROM "
					//L"(SELECT R4.EVENT, R4.MESUAR, R4.PEF AS PEF, R4.FEF AS FEF, R4.FEC AS FEC, R4.PCOST AS PCOST, R4.FCOST AS FCOST, R4.PTIME AS PTIME, R4.FTIME AS FTIME,"
					//L"EVS.TOTALPLANECONOMY AS PTEC, EVS.TOTALFACTCONOMY AS FTEC, EVS.TOTALPLANCOSTS AS PTCOST, EVS.TOTALFACTCOSTS AS FTCOST, EVS.TOTALPLANTIME AS PTTIME,"
					//L"EVS.TOTALFACTTIME AS FTTIME "
					//L"FROM "
					//L"(SELECT R1.EVENT, R1.MESUAR, R3.ID_EVENT_TYPE, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME, R3.PEC "
					//L"FROM "
					//L"(SELECT R2.ID_EVENT_TYPE, R1.EVENT, R1.MESUAR, SUM(R1.PEF) AS PEF, SUM(R2.FEF) AS FEF, SUM(R1.PEC) AS PEC, SUM(R2.FEC) AS FEC, SUM(R1.COST) AS PCOST, SUM(R2.FCOST) AS FCOST, SUM(R1.PTIME) AS PTIME, SUM(R2.FTIME) AS FTIME FROM "
					//L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, PI.MESUAR, SUM(PI.SAVEDS) AS PEF, SUM(PI.ECONOMY) AS PEC, SUM(PI.CURCOSTS) AS COST, SUM(PI.CURTIME) AS PTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					//L"(SELECT EVENT, MESUAR, SAVEDS, CURCOSTS, CURTIME, ECONOMY FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d GROUP BY PE.ID_EVENT_TYPE, PE.EVENT, PI.MESUAR) R1 "
					//L"INNER JOIN "
					//L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM PLAN_EVENT AS PE LEFT OUTER JOIN "
					//L"(SELECT EVENT, SAVEDS, CURCOSTS, ECONOMY, CURTIME FROM FACT_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) R2 "
					//L"ON R1.EVENT=R2.EVENT GROUP BY R2.ID_EVENT_TYPE, R1.EVENT) R3 "
					//L"INNER JOIN EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE) AS R4 INNER JOIN EVENTS AS EVS ON R4.EVENT=EVS.EVENT_NAME)) AS R4 INNER JOIN PLAN_INFO AS PI2 ON PI2.EVENT=R4.EVENT "
					//L"WHERE PI2.NYEAR<=%s "
					//L"GROUP BY R4.EVENT, R4.MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME) AS R5 INNER JOIN FACT_INFO AS FI2 ON R5.EVENT=FI2.EVENT WHERE FI2.NYEAR<=%s "
					//L"GROUP BY R5.EVENT, R5.MESUAR, PEF, FEF, FEC, PCOST, FCOST, PTIME, FTIME, PTEC, FTEC, PTCOST, FTCOST, PTTIME, FTTIME, ADDPEF, ADDPEC, ADDPTIME, ADDPCOST)",
					//db.m_szYear,
					//(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					//db.m_szYear,
					//(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					//db.m_szYear,
					//db.m_szYear);

					if(StrCmp(db.m_szQuart,L"0")!=0)
					{
						str.Format(
						L"SELECT R3.EVENT, ET.MEUAR, R3.PEF, R3.FEF, R3.FEC, R3.PCOST, R3.FCOST, R3.PTIME, R3.FTIME FROM "
						L"(SELECT R1.ID_EVENT_TYPE, R1.EVENT, R1.PEF, R2.FEF, R2.FEC, R1.PCOST, R2.FCOST, R1.PTIME, R2.FTIME "
						L"FROM (SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.CURCOSTS) AS PCOST, SUM(PI.CURTIME) AS PTIME FROM "
						L"PLAN_EVENT AS PE LEFT OUTER JOIN "
						L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND PE.NYEAR=%s AND ID_EVENT_TYPE=%d "
						L"GROUP BY PE.ID_EVENT_TYPE, PE.EVENT)  AS R1 INNER JOIN "
						L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM "
						L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI "
						L"ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND PE.NYEAR=%s AND ID_EVENT_TYPE=%d GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) AS R2 ON R1.EVENT=R2.EVENT) AS R3 INNER JOIN "
						L"EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE ORDER BY R3.PEF DESC",
						db.m_szYear,
						db.defineQuart(),
						(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
						db.m_szYear,
						db.defineResourceType(),
						db.m_szYear,
						db.defineQuart(),
						(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
						db.m_szYear,
						db.defineResourceType());

						if(StrCmp(db.m_szMonth,L"0")!=0)
						{
							str.Format(
							L"SELECT R3.EVENT, ET.MEUAR, R3.FEF, R3.FEC, R3.FCOST, R3.FTIME FROM "
							L"(SELECT R1.ID_EVENT_TYPE, R1.EVENT, R1.PEF, R2.FEF, R2.FEC, R1.PCOST, R2.FCOST, R1.PTIME, R2.FTIME "
							L"FROM (SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS PEF, SUM(PI.CURCOSTS) AS PCOST, SUM(PI.CURTIME) AS PTIME FROM "
							L"PLAN_EVENT AS PE LEFT OUTER JOIN "
							L"(SELECT EVENT, SAVEDS, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=%d AND PE.NYEAR=%s "
							L"GROUP BY PE.ID_EVENT_TYPE, PE.EVENT)  AS R1 INNER JOIN "
							L"(SELECT PE.ID_EVENT_TYPE, PE.EVENT, SUM(PI.SAVEDS) AS FEF, SUM(PI.CURCOSTS) AS FCOST, SUM(PI.ECONOMY) AS FEC, SUM(PI.CURTIME) AS FTIME FROM "
							L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d AND NMONTH=%d) AS PI "
							L"ON PE.EVENT=PI.EVENT WHERE PE.GENADD=%d AND ID_EVENT_TYPE=%d AND NYEAR=%s GROUP BY PE.ID_EVENT_TYPE, PE.EVENT) AS R2 ON R1.EVENT=R2.EVENT) AS R3 INNER JOIN "
							L"EVENT_TYPES AS ET ON R3.ID_EVENT_TYPE=ET.ID_EVENT_TYPE ORDER BY R3.FEF DESC",
							db.m_szYear,
							db.defineQuart(),
							(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
							db.defineResourceType(),
							db.m_szYear,
							db.m_szYear,
							db.defineQuart(),
							db.defineMonth(),
							(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
							db.defineResourceType(),
							db.m_szYear);
						}
					}
				}

				if(StrCmp(db.m_szEventName,L"0")!=0)
				{
					id_func+=1; //3 Выбрано мероприятие
					/*str.Format(
					L"SELECT T2.NAME_PLACE, T1.MESUAR, SUM(T1.SAVEDS), SUM(T1.ECONOMY), SUM(T1.CURCOSTS) FROM "
					L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s) AS T1 "
					L"LEFT OUTER JOIN "
					L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
					L"ON T1.ID_OBJECT=T2.ID_OBJECT "
					L"WHERE T1.EVENT='%s' "
					L"GROUP BY T2.NAME_PLACE, T1.MESUAR",
					db.m_szYear,
					db.m_szEventName);*/

					/*str.Format(
					L"SELECT NAME_PLACE, MEUAR, SSAV, SEC, SCOST, TOTALPLANECONOMY, TOTALPLANCOSTS FROM (SELECT ID_EVENTPLAN, EVENT, EVS.MEUAR, SSAV, SEC, SCOST, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS FROM "
					L"(SELECT ID_EVENTPLAN,EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME FROM "
					L"(SELECT PE.ID_EVENTPLAN, PE.EVENT, PE.ID_EVENT_TYPE, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME FROM "
					L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s) AS PI ON PE.EVENT=PI.EVENT "
					L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.ID_EVENTPLAN, PE.EVENT, PE.ID_EVENT_TYPE) AS T1 INNER JOIN EVENT_TYPES AS EVS " 
					L"ON EVS.ID_EVENT_TYPE=T1.ID_EVENT_TYPE WHERE T1.EVENT='%s') T2 INNER JOIN EVENTS "
					L"ON EVENTS.EVENT_NAME=T2.EVENT) T1 INNER JOIN PLACEOFUSEPLAN AS PLACE ON T1.ID_EVENTPLAN=PLACE.ID_EVENTPLAN",
					db.m_szYear,
					db.m_szYear,
					(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
					db.defineResourceType(),
					db.m_szEventName); */

					/*str.Format(
							L"SELECT R1.NAME, R1.MES, R1.PEF, R1.PEC, R1.PCOST, R1.PTIME FROM "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 "
							L"INNER JOIN "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM FACT_INFO WHERE NYEAR=%s) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R2 "
							L"ON R1.NAME=R2.NAME",
							db.m_szYear,
							db.m_szEventName,
							db.m_szYear,
							db.m_szEventName);*/

						//str.Format(
						//	L"SELECT R1.NAME, R1.MES, R1.PEF, R1.PEC, R1.PCOST, R1.PTIME FROM "
						//	L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
						//	L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s) AS T1 "
						//	L"LEFT OUTER JOIN "
						//	L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						//	L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						//	L"WHERE T1.EVENT='%s' "
						//	L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1",
						//	//L"INNER JOIN "
						//	//L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME FROM "
						//	//L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM FACT_INFO WHERE NYEAR=%s) AS T1 "
						//	//L"LEFT OUTER JOIN "
						//	//L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						//	//L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						//	//L"WHERE T1.EVENT='%s' "
						//	//L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R2 "
						//	//L"ON R1.NAME=R2.NAME",
						//	db.m_szYear,
						//	db.m_szEventName);

#ifdef CONVERTING_ALIAS
						str.Format(
						L"SELECT R1.NAME, R1.MES, R1.PEF, R1.PEC, R1.PCOST, R1.PTIME FROM "
						L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
						L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s) AS T1 "
						L"RIGHT OUTER JOIN "
						L"(SELECT O.ID_OBJECT, P.NAME_PLACE, P.ID_EVENTPLAN FROM OBJECTS_PLANS AS O RIGHT OUTER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						L"WHERE T2.ID_EVENTPLAN IN (SELECT ID_EVENTPLAN FROM PLAN_EVENT WHERE EVENT='%s' AND NYEAR=%s) "
						L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 ORDER BY R1.PEF DESC",
						db.m_szYear,
						db.Aliases(db.m_szEventName,ALIAS_TO_NAMES),
						db.m_szYear);
#else
						str.Format(
						L"SELECT R1.NAME, R1.MES, R1.PEF, R1.PEC, R1.PCOST, R1.PTIME FROM "
						L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
						L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s) AS T1 "
						L"RIGHT OUTER JOIN "
						L"(SELECT O.ID_OBJECT, P.NAME_PLACE, P.ID_EVENTPLAN FROM OBJECTS_PLANS AS O RIGHT OUTER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						L"WHERE T2.ID_EVENTPLAN IN (SELECT ID_EVENTPLAN FROM PLAN_EVENT WHERE EVENT='%s' AND NYEAR=%s) "
						L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 ORDER BY R1.PEF DESC",
						db.m_szYear,
						db.m_szEventName,
						db.m_szYear);
#endif

					if(StrCmp(db.m_szQuart,L"0")!=0)
					{
#ifdef CONVERTING_ALIAS
						str.Format(
						L"SELECT R1.NAME, R1.MES, R1.PEF, R1.PEC, R1.PCOST, R1.PTIME FROM "
						L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
						L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
						L"RIGHT OUTER JOIN "
						L"(SELECT O.ID_OBJECT, P.NAME_PLACE, P.ID_EVENTPLAN FROM OBJECTS_PLANS AS O RIGHT OUTER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						L"WHERE T2.ID_EVENTPLAN IN (SELECT ID_EVENTPLAN FROM PLAN_EVENT WHERE EVENT='%s' AND NYEAR=%s) "
						L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 ORDER BY R1.PEF DESC",
						db.m_szYear,
						db.defineQuart(),
						db.Aliases(db.m_szEventName,ALIAS_TO_NAMES),
						db.m_szYear);
#else
						str.Format(
						L"SELECT R1.NAME, R1.MES, R1.PEF, R1.PEC, R1.PCOST, R1.PTIME FROM "
						L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
						L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
						L"RIGHT OUTER JOIN "
						L"(SELECT O.ID_OBJECT, P.NAME_PLACE, P.ID_EVENTPLAN FROM OBJECTS_PLANS AS O RIGHT OUTER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						L"WHERE T2.ID_EVENTPLAN IN (SELECT ID_EVENTPLAN FROM PLAN_EVENT WHERE EVENT='%s' AND NYEAR=%s) "
						L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 ORDER BY R1.PEF DESC",
						db.m_szYear,
						db.defineQuart(),
						db.m_szEventName,
						db.m_szYear);
#endif
						//str.Format(
						//	L"SELECT R1.NAME, R1.MES, R1.PEF, R1.PEC, R1.PCOST, R1.PTIME FROM "
						//	L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
						//	L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
						//	L"LEFT OUTER JOIN "
						//	L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						//	L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						//	L"WHERE T1.EVENT='%s' "
						//	L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1",
						//	//L"INNER JOIN "
						//	//L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME FROM "
						//	//L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
						//	//L"LEFT OUTER JOIN "
						//	//L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						//	//L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						//	//L"WHERE T1.EVENT='%s' "
						//	//L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R2 "
						//	//L"ON R1.NAME=R2.NAME",
						//	db.m_szYear,
						//	db.defineQuart(),
						//	db.m_szEventName);
						//str.Format(
						///*
						//L"SELECT NAME_PLACE, MEUAR, SSAV, SEC, SCOST, TOTALPLANECONOMY, TOTALPLANCOSTS FROM (SELECT ID_EVENTPLAN, EVENT, EVS.MEUAR, SSAV, SEC, SCOST, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS FROM "
						//L"(SELECT ID_EVENTPLAN,EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME FROM "
						//L"(SELECT PE.ID_EVENTPLAN, PE.EVENT, PE.ID_EVENT_TYPE, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME FROM "
						//L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT "
						//L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.ID_EVENTPLAN, PE.EVENT, PE.ID_EVENT_TYPE) AS T1 INNER JOIN EVENT_TYPES AS EVS " 
						//L"ON EVS.ID_EVENT_TYPE=T1.ID_EVENT_TYPE WHERE T1.EVENT='%s') T2 INNER JOIN EVENTS "
						//L"ON EVENTS.EVENT_NAME=T2.EVENT) T1 INNER JOIN PLACEOFUSEPLAN AS PLACE ON T1.ID_EVENTPLAN=PLACE.ID_EVENTPLAN",
						//*/
						//L"SELECT R1.NAME, R1.MES, R1.PEF, R1.PEC, R1.PCOST, R1.PTIME FROM "			
						//L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
						//L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
						//L"LEFT OUTER JOIN "
						//L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						//L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						//L"WHERE T1.EVENT='%s' "
						//L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1",
						//db.m_szYear,
						//db.defineQuart(),
						//db.m_szYear,
						//(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
						//db.defineResourceType(),
						//db.m_szEventName); 
						/*
						str.Format(
						L"SELECT T2.NAME_PLACE, T1.MESUAR, SUM(T1.SAVEDS), SUM(T1.ECONOMY), SUM(T1.CURCOSTS) FROM "
						L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
						L"LEFT OUTER JOIN "
						L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
						L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						L"WHERE T1.EVENT='%s' "
						L"GROUP BY T2.NAME_PLACE, T1.MESUAR",
						db.m_szYear,
						db.defineQuart(),
						db.m_szEventName);
						*/
					}
					
					if(db.m_iStatus==FACT)
					{
#ifdef CONVERTING_ALIAS
						str.Format(
							L"SELECT R1.NAME, R1.MES, R1.PEF, R2.FEF, R2.FEC, R1.PCOST, R2.FCOST, R1.PTIME, R2.FTIME FROM "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 "
							L"INNER JOIN "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM FACT_INFO WHERE NYEAR=%s) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R2 "
							L"ON R1.NAME=R2.NAME ORDER BY R1.PEF",
							db.m_szYear,
							db.Aliases(db.m_szEventName,ALIAS_TO_NAMES),
							db.m_szYear,
							db.Aliases(db.m_szEventName,ALIAS_TO_NAMES));
#else
						str.Format(
							L"SELECT R1.NAME, R1.MES, R1.PEF, R2.FEF, R2.FEC, R1.PCOST, R2.FCOST, R1.PTIME, R2.FTIME FROM "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 "
							L"INNER JOIN "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM FACT_INFO WHERE NYEAR=%s) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R2 "
							L"ON R1.NAME=R2.NAME ORDER BY R1.PEF",
							db.m_szYear,
							db.m_szEventName,
							db.m_szYear,
							db.m_szEventName);
#endif
						
						if(StrCmp(db.m_szQuart,L"0")!=0)
						{
#ifdef CONVERTING_ALIAS
							str.Format(
							L"SELECT R1.NAME, R1.MES, R1.PEF, R2.FEF, R2.FEC, R1.PCOST, R2.FCOST, R1.PTIME, R2.FTIME FROM "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 "
							L"INNER JOIN "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R2 "
							L"ON R1.NAME=R2.NAME ORDER BY R1.PEF",
							db.m_szYear,
							db.defineQuart(),
							db.Aliases(db.m_szEventName,ALIAS_TO_NAMES),
							db.m_szYear,
							db.defineQuart(),
							db.Aliases(db.m_szEventName,ALIAS_TO_NAMES));
#else
							str.Format(
							L"SELECT R1.NAME, R1.MES, R1.PEF, R2.FEF, R2.FEC, R1.PCOST, R2.FCOST, R1.PTIME, R2.FTIME FROM "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 "
							L"INNER JOIN "
							L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME FROM "
							L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
							L"LEFT OUTER JOIN "
							L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
							L"ON T1.ID_OBJECT=T2.ID_OBJECT "
							L"WHERE T1.EVENT='%s' "
							L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R2 "
							L"ON R1.NAME=R2.NAME ORDER BY R1.PEF",
							db.m_szYear,
							db.defineQuart(),
							db.m_szEventName,
							db.m_szYear,
							db.defineQuart(),
							db.m_szEventName);
#endif

							if(StrCmp(db.m_szMonth,L"0")!=0)
							{
								//AfxMessageBox(L"Hello!!");
#ifdef CONVERTING_ALIAS
								str.Format(
								L"SELECT R1.NAME, R1.MES, R2.FEF, R2.FEC, R2.FCOST, R2.FTIME FROM "
								L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
								L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
								L"LEFT OUTER JOIN "
								L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
								L"ON T1.ID_OBJECT=T2.ID_OBJECT "
								L"WHERE T1.EVENT='%s' "
								L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 "
								L"INNER JOIN "
								L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME FROM "
								L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d AND NMONTH=%d) AS T1 "
								L"LEFT OUTER JOIN "
								L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
								L"ON T1.ID_OBJECT=T2.ID_OBJECT "
								L"WHERE T1.EVENT='%s' "
								L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R2 "
								L"ON R1.NAME=R2.NAME ORDER BY R2.FEF DESC",
								db.m_szYear,
								db.defineQuart(),
								db.Aliases(db.m_szEventName,ALIAS_TO_NAMES),
								db.m_szYear,
								db.defineQuart(),
								db.defineMonth(),
								db.Aliases(db.m_szEventName,ALIAS_TO_NAMES));
#else
								str.Format(
								L"SELECT R1.NAME, R1.MES, R2.FEF, R2.FEC, R2.FCOST, R2.FTIME FROM "
								L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
								L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS T1 "
								L"LEFT OUTER JOIN "
								L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
								L"ON T1.ID_OBJECT=T2.ID_OBJECT "
								L"WHERE T1.EVENT='%s' "
								L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R1 "
								L"INNER JOIN "
								L"(SELECT T2.NAME_PLACE AS NAME, T1.MESUAR AS MES, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME FROM "
								L"(SELECT EVENT, MESUAR, SAVEDS, ECONOMY, CURCOSTS, CURTIME, ID_OBJECT FROM FACT_INFO WHERE NYEAR=%s AND NQUART=%d AND NMONTH=%d) AS T1 "
								L"LEFT OUTER JOIN "
								L"(SELECT O.ID_OBJECT, P.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS P ON O.ID_PLACE=P.ID_PLACE) AS T2 "
								L"ON T1.ID_OBJECT=T2.ID_OBJECT "
								L"WHERE T1.EVENT='%s' "
								L"GROUP BY T2.NAME_PLACE, T1.MESUAR) AS R2 "
								L"ON R1.NAME=R2.NAME ORDER BY R2.FEF DESC",
								db.m_szYear,
								db.defineQuart(),
								db.m_szEventName,
								db.m_szYear,
								db.defineQuart(),
								db.defineMonth(),
								db.m_szEventName);
#endif
								
							}
						}

						/*
						str.Format(
						L"SELECT R2.NAME_PLACE, R2.MESUAR, R1.PEF, R2.FEF, R2.FEC, R1.PCOST, R2.FCOST, R1.PTIME, R2.FTIME FROM "
						L"(SELECT T1.EVENT, P.NAME_PLACE,  SUM(T1.SAVEDS) AS PEF, SUM(T1.ECONOMY) AS PEC, SUM(T1.CURCOSTS) AS PCOST, SUM(T1.CURTIME) AS PTIME FROM "
						L"(SELECT PE.ID_EVENTPLAN, PE.EVENT, PI.MESUAR, PI.SAVEDS, PI.ECONOMY, PI.CURCOSTS, PI.CURTIME, PI.ID_OBJECT "
						L"FROM PLAN_EVENT AS PE "
						L"INNER JOIN "
						L"PLAN_INFO AS PI ON PE.EVENT=PI.EVENT WHERE PE.NYEAR=%s AND PE.EVENT='%s') AS T1 "
						L"INNER JOIN PLACEOFUSEPLAN AS P "
						L"ON T1.ID_EVENTPLAN=P.ID_EVENTPLAN "
						L"GROUP BY T1.EVENT, P.NAME_PLACE) AS R1 " 
						L"INNER JOIN "
						L"(SELECT T1.EVENT, T2.NAME_PLACE, T1.MESUAR, SUM(T1.SAVEDS) AS FEF, SUM(T1.ECONOMY) AS FEC, SUM(T1.CURCOSTS) AS FCOST, SUM(T1.CURTIME) AS FTIME "
						L"FROM (SELECT FI.EVENT, FI.MESUAR, FI.SAVEDS, FI.ECONOMY, FI.CURCOSTS, FI.CURTIME, FI.ID_OBJECT "
						L"FROM PLAN_EVENT AS PE "
						L"INNER JOIN "
						L"FACT_INFO AS FI ON PE.EVENT=FI.EVENT WHERE PE.NYEAR=%s AND PE.EVENT='%s') AS T1 "
						L"INNER JOIN "
						L"(SELECT O.ID_OBJECT, PL.NAME_PLACE FROM OBJECTS_PLANS AS O INNER JOIN PLACEOFUSEPLAN AS PL ON O.ID_PLACE=PL.ID_PLACE)  AS T2 "
						L"ON T1.ID_OBJECT=T2.ID_OBJECT "
						L"GROUP BY T1.MESUAR, T2.NAME_PLACE, T1.EVENT) AS R2 "
						L"ON R1.NAME_PLACE=R2.NAME_PLACE",
						db.m_szYear,
						db.m_szEventName,
						db.m_szYear,
						db.m_szEventName);
						*/
					}
				}
			}
			
			//if(StrCmp(db.m_szQuart,L"0")!=0)
			//{
			//		//id_func+=10;//20 Выбран квартал
			//		if((StrCmp(db.m_szGenAdd,L"0")!=0)&&(StrCmp(db.m_szTypeResource,L"0")==0)&&(StrCmp(db.m_szEventName,L"0")==0))
			//		{
			//			str.Format(
			//			L"SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS FROM "
			//			L"(SELECT EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME FROM "
			//			L"(SELECT PE.EVENT, PE.ID_EVENT_TYPE, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME FROM "
			//			L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT "
			//			L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.EVENT, PE.ID_EVENT_TYPE) AS T1 INNER JOIN EVENT_TYPES AS EVS "
			//			L"ON EVS.ID_EVENT_TYPE=T1.ID_EVENT_TYPE) T2 INNER JOIN EVENTS "
			//			L"ON EVENTS.EVENT_NAME=T2.EVENT",
			//			db.m_szYear,
			//			db.defineQuart(),
			//			db.m_szYear,
			//			(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
			//			db.defineResourceType());
			//		}
			//		/*
			//		else
			//		{
			//			str.Format(
			//			L"SELECT NAME_PLACE, MEUAR, SSAV, SEC, SCOST, TOTALPLANECONOMY, TOTALPLANCOSTS FROM (SELECT ID_EVENTPLAN, EVENT, EVS.MEUAR, SSAV, SEC, SCOST, EVENTS.TOTALPLANECONOMY, EVENTS.TOTALPLANCOSTS FROM "
			//			L"(SELECT ID_EVENTPLAN,EVENT, EVS.MEUAR, SSAV, SEC, SCOST, STIME FROM "
			//			L"(SELECT PE.ID_EVENTPLAN, PE.EVENT, PE.ID_EVENT_TYPE, SUM(PI.SAVEDS) AS SSAV, SUM(PI.ECONOMY) AS SEC, SUM(PI.CURCOSTS) AS SCOST, SUM(PI.CURTIME) AS STIME FROM "
			//			L"PLAN_EVENT AS PE LEFT OUTER JOIN (SELECT EVENT, SAVEDS, ECONOMY, CURCOSTS, CURTIME FROM PLAN_INFO WHERE NYEAR=%s AND NQUART=%d) AS PI ON PE.EVENT=PI.EVENT "
			//			L"WHERE PE.NYEAR=%s AND PE.GENADD=%d AND PE.ID_EVENT_TYPE=%d GROUP BY PE.ID_EVENTPLAN, PE.EVENT, PE.ID_EVENT_TYPE) AS T1 INNER JOIN EVENT_TYPES AS EVS " 
			//			L"ON EVS.ID_EVENT_TYPE=T1.ID_EVENT_TYPE WHERE T1.EVENT='%s') T2 INNER JOIN EVENTS "
			//			L"ON EVENTS.EVENT_NAME=T2.EVENT) T1 INNER JOIN PLACEOFUSEPLAN AS PLACE ON T1.ID_EVENTPLAN=PLACE.ID_EVENTPLAN",
			//			db.m_szYear,
			//			db.defineQuart(),
			//			db.m_szYear,
			//			(StrCmp(db.m_szGenAdd,L"ОСНОВНОЙ ОТЧЕТ")==0?0:1),
			//			db.defineResourceType(),
			//			db.m_szEventName); 
			//		}
			//		*/
			//}
		}
	}

	//CString buf;
	//buf.Format(L"%d",id_func);
	//AfxMessageBox(buf);
	///AfxMessageBox(str);
	//AfxMessageBox(L"->>>CriterianY");
	CriterianY(plist,str,id_func);

	//for (int i = 0; i < crq.m_lRecCount; i++)	
	//{
	//	delete [] crq.m_RetValues[i];
	//}
	//delete [] crq.m_RetValues;

	plist=NULL; //delete plist;
	//delete plist;
	//AfxMessageBox(L"Ok");
}


bool CMFCApplication30View::CriterianY(CGenList* cgl, CString& str, int& id)
{
	CString b=str;
	CString buf;
	CRetQuery crq; crq.m_lRecCount=0;
	CString s22;
	double dRes;
	//AfxMessageBox(str);
	//s22.Format(L"%d",id);
	//AfxMessageBox(s22);

	//s22.Format(L"%d",id);
	//AfxMessageBox(s22);

	switch(id)
	{
	case 11:
#pragma region Year and Report
		SetColumnListCtrl(id,&cgl->GetListCtrl());
		//AfxMessageBox(L"SetColumnList - OK!!!");
		//Заполням по природному газу
		if(db.m_iStatus==PLAN)
		{
			b.Replace(L"-TYPE-",L"2");
			db.fQueryRead(b,crq);

			for(int i=3;i<9;i++)
			{
				cgl->GetListCtrl().SetItemText(0,i,crq.m_RetValues[0][i-3]);
			}
			b=str;
			//Заполняем по электричеству
			b.Replace(L"-TYPE-",L"3");
			db.fQueryRead(b,crq);
			for(int i=3;i<9;i++)
			{
				cgl->GetListCtrl().SetItemText(1,i,crq.m_RetValues[0][i-3]);
			}
			b=str;
			//Заполняем по тепловой энергии
			b.Replace(L"-TYPE-",L"4");
			db.fQueryRead(b,crq);
			for(int i=3;i<9;i++)
			{
				cgl->GetListCtrl().SetItemText(2,i,crq.m_RetValues[0][i-3]);
			}
			//b=str;
		}
		if(db.m_iStatus==FACT)
		{
			//Заполняем по природному газу
			b.Replace(L"-TYPE-",L"2");
	
			FillTable11(b,0,cgl);
			
			b=str;
			//AfxMessageBox(L"TYPE2 - OK");
			
			//Заполняем по электричеству
			b.Replace(L"-TYPE-",L"3");
			
			FillTable11(b,1,cgl);

			b=str;
			//AfxMessageBox(L"TYPE3 - OK");
			//Заполняем по теплу
			
			b.Replace(L"-TYPE-",L"4");

			FillTable11(b,2,cgl);
			
			b=str;
			//AfxMessageBox(L"TYPE4 - OK");
		}
		
		break;
#pragma endregion Выбран год и один из отчетов
	case 12:
#pragma region Year, Report and Rresource
		SetColumnListCtrl(id,&cgl->GetListCtrl());



		db.fQueryRead(b,crq);
	
#ifdef CONVERTING_ALIAS
		db.Aliases(crq,0,NAMES_TO_ALIAS);
#endif

		//s22.Format(L"%s",crq.m_RetValues[0][2]);
		//AfxMessageBox(s22);

		if(crq.m_lRecCount>0)
		{
			if(db.m_iStatus==FACT)
			{
				for(int i=0;i<crq.m_lRecCount;i++)
				{
					buf.Format(L"%d",i+1);
					cgl->GetListCtrl().InsertItem(i,buf,0);
					for(int a=1;a<10;a++)
					{
						if(a==3)
						{
							if(_wtof(crq.m_RetValues[i][2])==0)
							{
								cgl->GetListCtrl().SetItemText(i,a,L"-");
							}
							else
							{
								s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][3])/_wtof(crq.m_RetValues[i][2])*100);
								cgl->GetListCtrl().SetItemText(i,a,s22);
							}
						}
						else
						if(a==4)
						{
							if(_wtof(crq.m_RetValues[i][7])==0)
							{
								cgl->GetListCtrl().SetItemText(i,a,L"-");
							}
							else
							{
								s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][8])/_wtof(crq.m_RetValues[i][7])*100);
								cgl->GetListCtrl().SetItemText(i,a,s22);
							}
						}
						else
						if(a==5)
						{
								if(_wtof(crq.m_RetValues[i][5])==0)
								{
									cgl->GetListCtrl().SetItemText(i,a,L"-");
								}
								else
								{
									s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][6])/_wtof(crq.m_RetValues[i][5])*100);
									cgl->GetListCtrl().SetItemText(i,a,s22);
								}
							}
							else
							if(a<3)
									cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-1]);
						}


						for(int a=6;a<13;a++)
						{
							cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-4]);
						}

						//dRes=crq.m_lColCount;
						//s22.Format(L"%f",dRes);
						//AfxMessageBox(s22);

						////TOTALPLANECONOMY==0
						//AfxMessageBox(crq.m_RetValues[i][9]);
						if(_wtof(crq.m_RetValues[i][9])==0)
						{
							cgl->GetListCtrl().SetItemText(i,13,L"-");
						}
						else
						{
							dRes=_wtof(crq.m_RetValues[i][10])/_wtof(crq.m_RetValues[i][9])*100;
							buf.Format(L"%.0f",dRes);
							//AfxMessageBox(buf);
							cgl->GetListCtrl().SetItemText(i,13,buf);
						}
						////TOTALPLANCOST==0
						if(_wtof(crq.m_RetValues[i][11])==0)
						{
							cgl->GetListCtrl().SetItemText(i,14,L"-");
						}
						else
						{
							dRes=_wtof(crq.m_RetValues[i][12])/_wtof(crq.m_RetValues[i][11])*100;
							buf.Format(L"%.0f",dRes);
							cgl->GetListCtrl().SetItemText(i,14,buf);
						}
						////TOTALPLANTIME==0
						if(_wtof(crq.m_RetValues[i][13])==0)
						{
							cgl->GetListCtrl().SetItemText(i,15,L"-");
						}
						else
						{
							dRes=_wtof(crq.m_RetValues[i][14])/_wtof(crq.m_RetValues[i][13])*100;
							buf.Format(L"%.0f",dRes);
							cgl->GetListCtrl().SetItemText(i,15,buf);
						}

						//cgl->GetListCtrl().SetItemText(iRow,3,crq.m_RetValues[0][2]);

						/*for(int c=5;c<12;c++)
						{
							cgl->GetListCtrl().SetItemText(i,c,crq.m_RetValues[i][c-5]);
						}
						*/
						for(int c=16;c<22;c++)
						{
							cgl->GetListCtrl().SetItemText(i,c,crq.m_RetValues[i][c-7]);
						}
					}
			}
			else
				if(db.m_iStatus==PLAN)
				{
					if(crq.m_lRecCount>0)
					{
						for(int i=0;i<crq.m_lRecCount;i++)
						{
							buf.Format(L"%d",i+1);
							cgl->GetListCtrl().InsertItem(i,buf,0);
							for(int a=1;a<10;a++)
							{
								cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-1]);
							}
						}
					}
				}
		}
		break;
#pragma endregion Выбран год, отчет, тип ресурса
	case 13:
#pragma region Year, Report, Resource, Event
		SetColumnListCtrl(id,&cgl->GetListCtrl());
		
		db.fQueryRead(b,crq);

		if(db.m_iStatus==PLAN)
		{
			if(crq.m_lRecCount>0)
			{
				for(int i=0;i<crq.m_lRecCount;i++)
				{
					buf.Format(L"%d",i+1);
					cgl->GetListCtrl().InsertItem(i,buf,0);
					for(int a=1;a<7;a++)
					{
						cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-1]);
					}
				}
			}
		}
		else
			if(db.m_iStatus==FACT)
			{
				for(int i=0;i<crq.m_lRecCount;i++)
				{
					buf.Format(L"%d",i+1);
					cgl->GetListCtrl().InsertItem(i,buf,0);
					for(int a=1;a<10;a++)
					{
						if(a==3)
						{
							if(_wtof(crq.m_RetValues[i][2])==0)
							{
								cgl->GetListCtrl().SetItemText(i,a,L"-");
							}
							else
							{
								s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][3])/_wtof(crq.m_RetValues[i][2])*100);
								cgl->GetListCtrl().SetItemText(i,a,s22);
							}
						}
						else
						if(a==4)
						{
							if(_wtof(crq.m_RetValues[i][7])==0)
							{
								cgl->GetListCtrl().SetItemText(i,a,L"-");
							}
							else
							{
								s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][8])/_wtof(crq.m_RetValues[i][7])*100);
								cgl->GetListCtrl().SetItemText(i,a,s22);
							}
						}
						else
						if(a==5)
						{
								if(_wtof(crq.m_RetValues[i][5])==0)
								{
									cgl->GetListCtrl().SetItemText(i,a,L"-");
								}
								else
								{
									s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][6])/_wtof(crq.m_RetValues[i][5])*100);
									cgl->GetListCtrl().SetItemText(i,a,s22);
								}
							}
							else
							if(a<3)
									cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-1]);
						}
						for(int a=6;a<13;a++)
						{
							cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-4]);
						}
					}
			}
#pragma endregion Выбран год, отчет, тип ресурса, мероприятие
		break;
	case 21:
		//Выбран год, выбран квартал
		SetColumnListCtrl(id,&cgl->GetListCtrl());

		if(db.m_iStatus==PLAN)
		{
			b.Replace(L"-TYPE-",L"2");
			db.fQueryRead(b,crq);

			for(int i=3;i<9;i++)
			{
				cgl->GetListCtrl().SetItemText(0,i,crq.m_RetValues[0][i-3]);
			}
			b=str;
			//Заполняем по электричеству
			b.Replace(L"-TYPE-",L"3");
			db.fQueryRead(b,crq);
			for(int i=3;i<9;i++)
			{
				cgl->GetListCtrl().SetItemText(1,i,crq.m_RetValues[0][i-3]);
			}
			b=str;
			//Заполняем по тепловой энергии
			b.Replace(L"-TYPE-",L"4");
			db.fQueryRead(b,crq);
			for(int i=3;i<9;i++)
			{
				cgl->GetListCtrl().SetItemText(2,i,crq.m_RetValues[0][i-3]);
			}
			//b=str;
			//b.Replace(L"-TYPE-",L"2");
			//db.fQueryRead(b,crq);

			//s22.Format(L"%d",crq.m_lRecCount);

			//for(int i=2;i<8;i++)
			//{
			//	cgl->GetListCtrl().SetItemText(0,i,crq.m_RetValues[0][i-2]);
			//}
			//b=str;
			////Заполняем по электричеству
			//b.Replace(L"-TYPE-",L"3");
			//db.fQueryRead(b,crq);
			//for(int i=2;i<8;i++)
			//{
			//	cgl->GetListCtrl().SetItemText(1,i,crq.m_RetValues[0][i-2]);
			//}
			//b=str;
			////Заполняем по тепловой энергии
			//b.Replace(L"-TYPE-",L"4");
			//db.fQueryRead(b,crq);
			//for(int i=2;i<8;i++)
			//{
			//	cgl->GetListCtrl().SetItemText(2,i,crq.m_RetValues[0][i-2]);
			//}
			////b=str;
		}
		if(db.m_iStatus==FACT)
		{
			//Заполняем по природному газу
			b.Replace(L"-TYPE-",L"2");
	
			FillTable11(b,0,cgl);
			
			b=str;
			
			//Заполняем по электричеству
			b.Replace(L"-TYPE-",L"3");
			
			FillTable11(b,1,cgl);

			b=str;

			//Заполняем по теплу
			
			b.Replace(L"-TYPE-",L"4");

			FillTable11(b,2,cgl);
			
			b=str;
			//b.Replace(L"-TYPE-",L"2");
			////AfxMessageBox(b);
			//
			////FillTable11(b,0,cgl);
			//db.fQueryRead(b,crq);

			////s22.Format(L"%d",crq.m_lColCount);
			////AfxMessageBox(s22);

			//double dRes;

			//if(_wtof(crq.m_RetValues[0][0])==0)
			//{
			//	cgl->GetListCtrl().SetItemText(0,3,L"-");
			//}
			//else
			//{
			//	dRes=_wtof(crq.m_RetValues[0][1])/_wtof(crq.m_RetValues[0][0])*100;
			//	buf.Format(L"%.0f",dRes);
			//	cgl->GetListCtrl().SetItemText(0,3,buf);
			//}

			//if(_wtof(crq.m_RetValues[0][5])==0)
			//{
			//	cgl->GetListCtrl().SetItemText(0,4,L"-");
			//}
			//else
			//{
			//	dRes=_wtof(crq.m_RetValues[0][6])/_wtof(crq.m_RetValues[0][5])*100;
			//	buf.Format(L"%.0f",dRes);
			//	cgl->GetListCtrl().SetItemText(0,4,buf);
			//}

			//if(_wtof(crq.m_RetValues[0][3])==0)
			//{
			//	cgl->GetListCtrl().SetItemText(0,5,L"-");
			//}
			//else
			//{
			//	dRes=_wtof(crq.m_RetValues[0][4])/_wtof(crq.m_RetValues[0][3])*100;
			//	buf.Format(L"%.0f",dRes);
			//	cgl->GetListCtrl().SetItemText(0,5,buf);
			//}
			//
			//for(int i=6;i<13;i++)
			//{
			//	cgl->GetListCtrl().SetItemText(0,i,crq.m_RetValues[0][i-6]);
			//}
			//b=str;
			////AfxMessageBox(L"sd");

			////Заполняем по электричеству
			//b.Replace(L"-TYPE-",L"3");
			//
			////FillTable11(b,1,cgl);
			//db.fQueryRead(b,crq);

			//if(crq.m_lRecCount==0)
			//	return false;

			//if(_wtof(crq.m_RetValues[0][0])==0)
			//{
			//	cgl->GetListCtrl().SetItemText(1,3,L"-");
			//}
			//else
			//{
			//	dRes=_wtof(crq.m_RetValues[0][1])/_wtof(crq.m_RetValues[0][0])*100;
			//	buf.Format(L"%.0f",dRes);
			//	cgl->GetListCtrl().SetItemText(1,3,buf);
			//}

			//if(_wtof(crq.m_RetValues[0][5])==0)
			//{
			//	cgl->GetListCtrl().SetItemText(1,4,L"-");
			//}
			//else
			//{
			//	dRes=_wtof(crq.m_RetValues[0][6])/_wtof(crq.m_RetValues[0][5])*100;
			//	buf.Format(L"%.0f",dRes);
			//	cgl->GetListCtrl().SetItemText(1,4,buf);
			//}

			//if(_wtof(crq.m_RetValues[0][3])==0)
			//{
			//	cgl->GetListCtrl().SetItemText(1,5,L"-");
			//}
			//else
			//{
			//	dRes=_wtof(crq.m_RetValues[0][4])/_wtof(crq.m_RetValues[0][3])*100;
			//	buf.Format(L"%.0f",dRes);
			//	cgl->GetListCtrl().SetItemText(1,5,buf);
			//}
			//
			//for(int i=6;i<13;i++)
			//{
			//	cgl->GetListCtrl().SetItemText(1,i,crq.m_RetValues[0][i-6]);
			//}
			//b=str;

			////Заполняем по теплу
			//
			//b.Replace(L"-TYPE-",L"4");

			////FillTable11(b,2,cgl);
			//db.fQueryRead(b,crq);

			//if(_wtof(crq.m_RetValues[0][0])==0)
			//{
			//	cgl->GetListCtrl().SetItemText(2,3,L"-");
			//}
			//else
			//{
			//	dRes=_wtof(crq.m_RetValues[0][1])/_wtof(crq.m_RetValues[0][0])*100;
			//	buf.Format(L"%.0f",dRes);
			//	cgl->GetListCtrl().SetItemText(2,3,buf);
			//}

			//if(_wtof(crq.m_RetValues[0][5])==0)
			//{
			//	cgl->GetListCtrl().SetItemText(2,4,L"-");
			//}
			//else
			//{
			//	dRes=_wtof(crq.m_RetValues[0][6])/_wtof(crq.m_RetValues[0][5])*100;
			//	buf.Format(L"%.0f",dRes);
			//	cgl->GetListCtrl().SetItemText(2,4,buf);
			//}

			//if(_wtof(crq.m_RetValues[0][3])==0)
			//{
			//	cgl->GetListCtrl().SetItemText(2,5,L"-");
			//}
			//else
			//{
			//	dRes=_wtof(crq.m_RetValues[0][4])/_wtof(crq.m_RetValues[0][3])*100;
			//	buf.Format(L"%.0f",dRes);
			//	cgl->GetListCtrl().SetItemText(2,5,buf);
			//}
			//
			//for(int i=6;i<13;i++)
			//{
			//	cgl->GetListCtrl().SetItemText(2,i,crq.m_RetValues[0][i-6]);
			//}
			//b=str;
		}
		break;
	case 22:
#pragma region Year, Quartal, Report, Resource
		SetColumnListCtrl(id,&cgl->GetListCtrl());
		db.fQueryRead(b,crq);
	
#ifdef CONVERTING_ALIAS
		db.Aliases(crq,0,NAMES_TO_ALIAS);
#endif

		if(crq.m_lRecCount>0)
		{
			if(db.m_iStatus==FACT)
			{
				for(int i=0;i<crq.m_lRecCount;i++)
				{
					buf.Format(L"%d",i+1);
					cgl->GetListCtrl().InsertItem(i,buf,0);
					for(int a=1;a<10;a++)
					{
						if(a==3)
						{
							if(_wtof(crq.m_RetValues[i][2])==0)
							{
								cgl->GetListCtrl().SetItemText(i,a,L"-");
							}
							else
							{
								s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][3])/_wtof(crq.m_RetValues[i][2])*100);
								cgl->GetListCtrl().SetItemText(i,a,s22);
							}
						}
						else
						if(a==4)
						{
							if(_wtof(crq.m_RetValues[i][7])==0)
							{
								cgl->GetListCtrl().SetItemText(i,a,L"-");
							}
							else
							{
								s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][8])/_wtof(crq.m_RetValues[i][7])*100);
								cgl->GetListCtrl().SetItemText(i,a,s22);
							}
						}
						else
						if(a==5)
						{
								if(_wtof(crq.m_RetValues[i][5])==0)
								{
									cgl->GetListCtrl().SetItemText(i,a,L"-");
								}
								else
								{
									s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][6])/_wtof(crq.m_RetValues[i][5])*100);
									cgl->GetListCtrl().SetItemText(i,a,s22);
								}
							}
							else
							if(a<3)
									cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-1]);
						}
						for(int a=6;a<13;a++)
						{
							cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-4]);
						}
					}
			}
			else
				if(db.m_iStatus==PLAN)
				{
					//AfxMessageBox(crq.m_lRecCount);
					if(crq.m_lRecCount>0)
					{
						for(int i=0;i<crq.m_lRecCount;i++)
						{
							buf.Format(L"%d",i+1);
							cgl->GetListCtrl().InsertItem(i,buf,0);
							for(int a=1;a<9;a++)
							{
								cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-1]);
							}
						}
					}
				}
		}
#pragma endregion Выбран год, квартал, отчет, тип ресурса 
		break;
	case 23:
#pragma region Year, Quartal, Report, Resource, Event
		SetColumnListCtrl(id,&cgl->GetListCtrl());
		
		db.fQueryRead(b,crq);

		//s22.Format(L"%d",crq.m_lRecCount);
		//AfxMessageBox(b);

		if(db.m_iStatus==PLAN)
		{
			if(crq.m_lRecCount>0)
			{
				for(int i=0;i<crq.m_lRecCount;i++)
				{
					buf.Format(L"%d",i+1);
					cgl->GetListCtrl().InsertItem(i,buf,0);
					for(int a=1;a<8;a++)
					{
						cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-1]);
					}
				}
			}
		}
		else
			if(db.m_iStatus==FACT)
			{
				for(int i=0;i<crq.m_lRecCount;i++)
				{
					buf.Format(L"%d",i+1);
					cgl->GetListCtrl().InsertItem(i,buf,0);
					for(int a=1;a<10;a++)
					{
						if(a==3)
						{
							if(_wtof(crq.m_RetValues[i][2])==0)
							{
								cgl->GetListCtrl().SetItemText(i,a,L"-");
							}
							else
							{
								s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][3])/_wtof(crq.m_RetValues[i][2])*100);
								cgl->GetListCtrl().SetItemText(i,a,s22);
							}
						}
						else
						if(a==4)
						{
							if(_wtof(crq.m_RetValues[i][7])==0)
							{
								cgl->GetListCtrl().SetItemText(i,a,L"-");
							}
							else
							{
								s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][8])/_wtof(crq.m_RetValues[i][7])*100);
								cgl->GetListCtrl().SetItemText(i,a,s22);
							}
						}
						else
						if(a==5)
						{
								if(_wtof(crq.m_RetValues[i][5])==0)
								{
									cgl->GetListCtrl().SetItemText(i,a,L"-");
								}
								else
								{
									s22.Format(L"%.0f",_wtof(crq.m_RetValues[i][6])/_wtof(crq.m_RetValues[i][5])*100);
									cgl->GetListCtrl().SetItemText(i,a,s22);
								}
							}
							else
							if(a<3)
									cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-1]);
						}
						for(int a=6;a<13;a++)
						{
							cgl->GetListCtrl().SetItemText(i,a,crq.m_RetValues[i][a-4]);
						}
					}
			}
#pragma endregion Выбран год, квартал, отчет, тип ресурса, мероприятие
		break;
	case 31:
		SetColumnListCtrl(id,&cgl->GetListCtrl());
		
		if(db.m_iStatus==FACT)
		{
			b.Replace(L"-TYPE-",L"2");
			//AfxMessageBox(b);
			db.fQueryRead(b,crq);
			for(int i=3;(i<7)&&(crq.m_lRecCount>0);i++)
			{
				cgl->GetListCtrl().SetItemText(0,i,crq.m_RetValues[0][i-3]);
			}
			b=str;
			b.Replace(L"-TYPE-",L"3");
			//AfxMessageBox(b);
			db.fQueryRead(b,crq);
			for(int i=3;(i<7)&&(crq.m_lRecCount>0);i++)
			{
				cgl->GetListCtrl().SetItemText(1,i,crq.m_RetValues[0][i-3]);
			}
			b=str;
			b.Replace(L"-TYPE-",L"4");
			//AfxMessageBox(b);
			db.fQueryRead(b,crq);
			for(int i=3;(i<7)&&(crq.m_lRecCount>0);i++)
			{
				cgl->GetListCtrl().SetItemText(2,i,crq.m_RetValues[0][i-3]);
			}
			b=str;
			/*
			for(int res=0;res<3;res++)
			{
				for(int i=3;i<7;i++)
				{
					cgl->GetListCtrl().SetItemText(i,res,crq.m_RetValues[res][i-3]);
				}
			}*/
			/*
			//НЕ ПОДХОДИТ ДЛЯ МЕСЯЧНЫХ ДАННЫХ, Т.К. СОДЕРЖИТ ПЛАНОВЫЕ КВАРТАЛЬНЫЕ ПОКАЗАИТЕЛИ
			b.Replace(L"-TYPE-",L"2");
			db.fQueryRead(b,crq);
			double dRes;
			if(_wtof(crq.m_RetValues[0][0])==0)
			{
				cgl->GetListCtrl().SetItemText(0,3,L"-");
			}
			else
			{
				dRes=_wtof(crq.m_RetValues[0][1])/_wtof(crq.m_RetValues[0][0])*100;
				buf.Format(L"%.0f",dRes);
				cgl->GetListCtrl().SetItemText(0,3,buf);
			}
			 
			if(_wtof(crq.m_RetValues[0][3])==0)
			{
				cgl->GetListCtrl().SetItemText(0,4,L"-");
			}
			else
			{
				dRes=_wtof(crq.m_RetValues[0][4])/_wtof(crq.m_RetValues[0][3])*100;
				buf.Format(L"%.0f",dRes);
				cgl->GetListCtrl().SetItemText(0,4,buf);
			}
			
			for(int i=5;i<10;i++)
			{
				cgl->GetListCtrl().SetItemText(0,i,crq.m_RetValues[0][i-5]);
			}
			b=str;
			
			//Заполняем по электричеству
			b.Replace(L"-TYPE-",L"3");
			db.fQueryRead(b,crq);
			if(_wtof(crq.m_RetValues[0][0])==0)
			{
				cgl->GetListCtrl().SetItemText(1,3,L"-");
			}
			else
			{
				dRes=_wtof(crq.m_RetValues[0][1])/_wtof(crq.m_RetValues[0][0])*100;
				buf.Format(L"%.0f",dRes);
				cgl->GetListCtrl().SetItemText(1,3,buf);
			}

			if(_wtof(crq.m_RetValues[0][3])==0)
			{
				cgl->GetListCtrl().SetItemText(1,4,L"-");
			}
			else
			{
				dRes=_wtof(crq.m_RetValues[0][4])/_wtof(crq.m_RetValues[0][3])*100;
				buf.Format(L"%.0f",dRes);
				cgl->GetListCtrl().SetItemText(1,4,buf);
			}
			
			for(int i=5;i<10;i++)
			{
				cgl->GetListCtrl().SetItemText(1,i,crq.m_RetValues[0][i-5]);
			}
			b=str;

			//Заполняем по теплу
			
			b.Replace(L"-TYPE-",L"4");
			db.fQueryRead(b,crq);

			if(_wtof(crq.m_RetValues[0][0])==0)
			{
				cgl->GetListCtrl().SetItemText(2,3,L"-");
			}
			else
			{
				dRes=_wtof(crq.m_RetValues[0][1])/_wtof(crq.m_RetValues[0][0])*100;
				buf.Format(L"%.0f",dRes);
				cgl->GetListCtrl().SetItemText(2,3,buf);
			}

			if(_wtof(crq.m_RetValues[0][3])==0)
			{
				cgl->GetListCtrl().SetItemText(2,4,L"-");
			}
			else
			{
				dRes=_wtof(crq.m_RetValues[0][4])/_wtof(crq.m_RetValues[0][3])*100;
				buf.Format(L"%.0f",dRes);
				cgl->GetListCtrl().SetItemText(2,4,buf);
			}
			
			for(int i=5;i<10;i++)
			{
				cgl->GetListCtrl().SetItemText(2,i,crq.m_RetValues[0][i-5]);
			}
			b=str;
			*/
		}

		break;
	case 32:
		SetColumnListCtrl(id,&cgl->GetListCtrl());

		db.fQueryRead(b,crq);

		for(int row=0;row<crq.m_lRecCount;row++)
		{
			buf.Format(L"%d",row+1);
			cgl->GetListCtrl().InsertItem(row,buf,0);

			for(int field=1;field<7;field++)
			{
				cgl->GetListCtrl().SetItemText(row,field,crq.m_RetValues[row][field-1]);
			}
		}

		break;

	case 33:
		SetColumnListCtrl(id,&cgl->GetListCtrl());
		
		db.fQueryRead(b,crq);

#ifdef CONVERTING_ALIAS
		db.Aliases(crq,0,NAMES_TO_ALIAS);
#endif

		for(int row=0;row<crq.m_lRecCount;row++)
		{
			buf.Format(L"%d",row+1);
			cgl->GetListCtrl().InsertItem(row,buf,0);

			for(int field=1;field<7;field++)
			{
				cgl->GetListCtrl().SetItemText(row,field,crq.m_RetValues[row][field-1]);
			}
		}

		break;

	default:

		break;
	}

	//CString B;
	//B.Format(L"%d",id);
	//AfxMessageBox(B);
	//AfxMessageBox(L"->if(id!=0)");
	if(id!=0 && crq.m_lRecCount>0)
	{
		for (int i = 0; i < crq.m_lRecCount; i++)	
		{
			delete [] crq.m_RetValues[i];
		}
		if(crq.m_lRecCount>0)
		delete [] crq.m_RetValues;
	}
	//AfxMessageBox(L"if(id!=0) - OK");
	return false;
}


bool CMFCApplication30View::SetColumnListCtrl(int& id, CListCtrl* plist)
{
	plist->DeleteAllItems();

	while(plist->DeleteColumn(0));

	CString s;

	switch(id)
	{
	case 11:
		plist->InsertColumn(0,L"№п/п",LVCFMT_LEFT,50);
		plist->InsertColumn(1,L"Наименование ресурсов",LVCFMT_LEFT,200);

		//При отображении плана
		if(db.m_iStatus==PLAN)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"П.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"П.Эк.эффект, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(5,L"П.Затраты, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Общий эк.эффект, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(7,L"П.Общие затраты, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(8,L"П.Общее время, ч",LVCFMT_LEFT,150);
		}

		if(db.m_iStatus==FACT)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"Вып.%",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"Затр.%",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(7,L"Ф.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(8,L"Ф.Эк.эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(9,L"П.Затраты",LVCFMT_LEFT,100);
			plist->InsertColumn(10,L"Ф.Затраты",LVCFMT_LEFT,100);
			plist->InsertColumn(11,L"П.Время.о.п.,ч",LVCFMT_LEFT,150);
			plist->InsertColumn(12,L"Ф.Время.о.п.,ч",LVCFMT_LEFT,150);
			plist->InsertColumn(13,L"% Эк.эфф.н.р.",LVCFMT_LEFT,150);
			plist->InsertColumn(14,L"% Затраты.н.р.",LVCFMT_LEFT,150);
			plist->InsertColumn(15,L"% Время.н.р.",LVCFMT_LEFT,150);
			plist->InsertColumn(16,L"П.Эк.эффект.н.р.,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(17,L"Ф.Эк.эффект.н.р.,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(18,L"П.Затраты.н.р.,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(19,L"Ф.Затраты.н.р.,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(20,L"П.Вр.н.р.,ч",LVCFMT_LEFT,150);
			plist->InsertColumn(21,L"Ф.Вр.н.р.,ч",LVCFMT_LEFT,150);
		}

		plist->InsertItem(0,L"1",0);
		plist->InsertItem(1,L"2",0);
		plist->InsertItem(2,L"3",0);

		plist->SetItemText(0,1,L"ПРИРОДНЫЙ ГАЗ");
		plist->SetItemText(1,1,L"ЭЛЕКТРОЭНЕРГИЯ");
		plist->SetItemText(2,1,L"ТЕПЛОВАЯ ЭНЕРГИЯ");

		plist->SetItemText(0,2,L"тыс.м3");
		plist->SetItemText(1,2,L"тыс.кВт х ч");
		plist->SetItemText(2,2,L"Гкал");
		
		break;
	case 12:
		plist->InsertColumn(0,L"№п/п",LVCFMT_LEFT,50);
		plist->InsertColumn(1,L"Наименование мероприятия",LVCFMT_LEFT,200);
		if(db.m_iStatus==PLAN)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"П.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"П.Эк.эффект, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(5,L"П.Затраты, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Время раб, ч",LVCFMT_LEFT,100);
			plist->InsertColumn(7,L"П.Общий эк.эффект, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(8,L"П.Общие затраты, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(9,L"П.Общее время, ч",LVCFMT_LEFT,150);
		}
		if(db.m_iStatus==FACT)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"% Вып",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"% Тр.о.п.",LVCFMT_LEFT,100);
			plist->InsertColumn(5,L"% Затраты",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Эффект",LVCFMT_LEFT,150);
			plist->InsertColumn(7,L"Ф.Эффект",LVCFMT_LEFT,150);
			plist->InsertColumn(8,L"Ф.Эк.эффект,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(9,L"П.Затраты,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(10,L"Ф.Затраты,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(11,L"П.Время.о.п.,ч",LVCFMT_LEFT,150);
			plist->InsertColumn(12,L"Ф.Время.о.п.,ч",LVCFMT_LEFT,150);
			plist->InsertColumn(13,L"% Эк.эфф.н.р.",LVCFMT_LEFT,150);
			plist->InsertColumn(14,L"% Затраты.н.р.",LVCFMT_LEFT,150);
			plist->InsertColumn(15,L"% Время.н.р.",LVCFMT_LEFT,150);
			plist->InsertColumn(16,L"П.Эк.эффект.н.р.,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(17,L"Ф.Эк.эффект.н.р.,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(18,L"П.Затраты.н.р.,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(19,L"Ф.Затраты.н.р.,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(20,L"П.Вр.н.р.,ч",LVCFMT_LEFT,150);
			plist->InsertColumn(21,L"Ф.Вр.н.р.,ч",LVCFMT_LEFT,150);
		}

		break;
	case 13:
		plist->InsertColumn(0,L"№п/п",LVCFMT_LEFT,50);
		plist->InsertColumn(1,L"Наименование объекта внедрения",LVCFMT_LEFT,200);
		if(db.m_iStatus==PLAN)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"П.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"П.Эк.эффект, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(5,L"П.Затраты, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Время работы, ч",LVCFMT_LEFT,150);
		}
		else
			if(db.m_iStatus==FACT)
			{
				plist->InsertColumn(2,L"Е.И."					  ,LVCFMT_LEFT,100);
				plist->InsertColumn(3,L"% Вып"					  ,LVCFMT_LEFT,100);
				plist->InsertColumn(4,L"% Тр.о.п."				  ,LVCFMT_LEFT,100);
				plist->InsertColumn(5,L"% Затраты"				  ,LVCFMT_LEFT,100);
				plist->InsertColumn(6,L"П.Эффект"				  ,LVCFMT_LEFT,150);
				plist->InsertColumn(7,L"Ф.Эффект"				  ,LVCFMT_LEFT,150);
				plist->InsertColumn(8,L"Ф.Эк.эффект,тыс.руб"	  ,LVCFMT_LEFT,150);
				plist->InsertColumn(9,L"П.Затраты,тыс.руб"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(10,L"Ф.Затраты,тыс.руб"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(11,L"П.Время.о.п.,ч"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(12,L"Ф.Время.о.п.,ч"		  ,LVCFMT_LEFT,150);
			}
		break;
	case 21:
		plist->InsertColumn(0,L"№п/п",LVCFMT_LEFT,50);
		plist->InsertColumn(1,L"Наименование ресурсов",LVCFMT_LEFT,200);

		if(db.m_iStatus==PLAN)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"П.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"П.Эк.эффект, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(5,L"П.Затраты, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Общий эк.эффект, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(7,L"П.Общие затраты, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(8,L"П.Общее время, ч",LVCFMT_LEFT,150);
		}
		else
			if(db.m_iStatus==FACT)
			{
				plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
				plist->InsertColumn(3,L"Вып.%",LVCFMT_LEFT,100);
				plist->InsertColumn(4,L"Затр.%",LVCFMT_LEFT,100);
				plist->InsertColumn(6,L"П.Эффект",LVCFMT_LEFT,100);
				plist->InsertColumn(7,L"Ф.Эффект",LVCFMT_LEFT,100);
				plist->InsertColumn(8,L"Ф.Эк.эффект",LVCFMT_LEFT,100);
				plist->InsertColumn(9,L"П.Затраты",LVCFMT_LEFT,100);
				plist->InsertColumn(10,L"Ф.Затраты",LVCFMT_LEFT,100);
				plist->InsertColumn(11,L"П.Время.о.п.,ч",LVCFMT_LEFT,150);
				plist->InsertColumn(12,L"Ф.Время.о.п.,ч",LVCFMT_LEFT,150);
				plist->InsertColumn(13,L"% Эк.эфф.н.р.",LVCFMT_LEFT,150);
				plist->InsertColumn(14,L"% Затраты.н.р.",LVCFMT_LEFT,150);
				plist->InsertColumn(15,L"% Время.н.р.",LVCFMT_LEFT,150);
				plist->InsertColumn(16,L"П.Эк.эффект.н.р.,тыс.руб",LVCFMT_LEFT,150);
				plist->InsertColumn(17,L"Ф.Эк.эффект.н.р.,тыс.руб",LVCFMT_LEFT,150);
				plist->InsertColumn(18,L"П.Затраты.н.р.,тыс.руб",LVCFMT_LEFT,150);
				plist->InsertColumn(19,L"Ф.Затраты.н.р.,тыс.руб",LVCFMT_LEFT,150);
				plist->InsertColumn(20,L"П.Вр.н.р.,ч",LVCFMT_LEFT,150);
				plist->InsertColumn(21,L"Ф.Вр.н.р.,ч",LVCFMT_LEFT,150);
			}

		plist->InsertItem(0,L"1",0);
		plist->InsertItem(1,L"2",0);
		plist->InsertItem(2,L"3",0);

		plist->SetItemText(0,1,L"ПРИРОДНЫЙ ГАЗ");
		plist->SetItemText(1,1,L"ЭЛЕКТРОЭНЕРГИЯ");
		plist->SetItemText(2,1,L"ТЕПЛОВАЯ ЭНЕРГИЯ");

		plist->SetItemText(0,2,L"тыс.м3");
		plist->SetItemText(1,2,L"тыс.кВт х ч");
		plist->SetItemText(2,2,L"Гкал");
		break;
	case 22:
		plist->InsertColumn(0,L"№п/п",LVCFMT_LEFT,50);
		plist->InsertColumn(1,L"Наименование мероприятия",LVCFMT_LEFT,200);
		if(db.m_iStatus==PLAN)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"П.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"П.Эк.эффект, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(5,L"П.Затраты, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Общий эк.эффект, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(7,L"П.Общие затраты, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(8,L"П.Общее время, ч",LVCFMT_LEFT,150);
		}
		else
			if(db.m_iStatus==FACT)
			{
				plist->InsertColumn(2,L"Е.И."					  ,LVCFMT_LEFT,100);
				plist->InsertColumn(3,L"% Вып"					  ,LVCFMT_LEFT,100);
				plist->InsertColumn(4,L"% Тр.о.п."				  ,LVCFMT_LEFT,100);
				plist->InsertColumn(5,L"% Затраты"				  ,LVCFMT_LEFT,100);
				plist->InsertColumn(6,L"П.Эффект"				  ,LVCFMT_LEFT,150);
				plist->InsertColumn(7,L"Ф.Эффект"				  ,LVCFMT_LEFT,150);
				plist->InsertColumn(8,L"Ф.Эк.эффект,тыс.руб"	  ,LVCFMT_LEFT,150);
				plist->InsertColumn(9,L"П.Затраты,тыс.руб"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(10,L"Ф.Затраты,тыс.руб"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(11,L"П.Время.о.п.,ч"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(12,L"Ф.Время.о.п.,ч"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(13,L"% Эк.эфф.н.р."			  ,LVCFMT_LEFT,150);
				plist->InsertColumn(14,L"% Затраты.н.р."		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(15,L"% Время.н.р."			  ,LVCFMT_LEFT,150);
			}
		break;
	case 23:
		plist->InsertColumn(0,L"№п/п",LVCFMT_LEFT,50);
		plist->InsertColumn(1,L"Наименование объектов внедрения",LVCFMT_LEFT,200);
		if(db.m_iStatus==PLAN)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"П.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"П.Эк.эффект, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(5,L"П.Затраты, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Время работы, ч",LVCFMT_LEFT,150);
		}
		else
			if(db.m_iStatus==FACT)
			{
				plist->InsertColumn(2,L"Е.И."					  ,LVCFMT_LEFT,100);
				plist->InsertColumn(3,L"% Вып"					  ,LVCFMT_LEFT,100);
				plist->InsertColumn(4,L"% Тр.о.п."				  ,LVCFMT_LEFT,100);
				plist->InsertColumn(5,L"% Затраты"				  ,LVCFMT_LEFT,100);
				plist->InsertColumn(6,L"П.Эффект"				  ,LVCFMT_LEFT,150);
				plist->InsertColumn(7,L"Ф.Эффект"				  ,LVCFMT_LEFT,150);
				plist->InsertColumn(8,L"Ф.Эк.эффект,тыс.руб"	  ,LVCFMT_LEFT,150);
				plist->InsertColumn(9,L"П.Затраты,тыс.руб"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(10,L"Ф.Затраты,тыс.руб"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(11,L"П.Время.о.п.,ч"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(12,L"Ф.Время.о.п.,ч"		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(13,L"% Эк.эфф.н.р."			  ,LVCFMT_LEFT,150);
				plist->InsertColumn(14,L"% Затраты.н.р."		  ,LVCFMT_LEFT,150);
				plist->InsertColumn(15,L"% Время.н.р."			  ,LVCFMT_LEFT,150);
			}
		break;
	case 31:
		plist->InsertColumn(0,L"№п/п",LVCFMT_LEFT,50);
		plist->InsertColumn(1,L"Наименование ресурсов",LVCFMT_LEFT,200);

		if(db.m_iStatus==PLAN)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"П.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"П.Эк.эффект, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(5,L"П.Затраты, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Общий эк.эффект, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(7,L"П.Общие затраты, тыс.руб",LVCFMT_LEFT,150);
		}
		if(db.m_iStatus==FACT)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"Ф.Эффект",LVCFMT_LEFT,150);
			plist->InsertColumn(4,L"Ф.Эк.эффект,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(5,L"Ф.Затраты,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(6,L"Ф.Время.о.п.,ч",LVCFMT_LEFT,150);
		}
		plist->InsertItem(0,L"1",0);
		plist->InsertItem(1,L"2",0);
		plist->InsertItem(2,L"3",0);

		plist->SetItemText(0,1,L"ПРИРОДНЫЙ ГАЗ");
		plist->SetItemText(1,1,L"ЭЛЕКТРОЭНЕРГИЯ");
		plist->SetItemText(2,1,L"ТЕПЛОВАЯ ЭНЕРГИЯ");

		plist->SetItemText(0,2,L"тыс.м3");
		plist->SetItemText(1,2,L"тыс.кВт х ч");
		plist->SetItemText(2,2,L"Гкал");
		break;
	case 32:
		plist->InsertColumn(0,L"№п/п",LVCFMT_LEFT,50);
		plist->InsertColumn(1,L"Наименование мероприятия",LVCFMT_LEFT,200);
		if(db.m_iStatus==PLAN)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"П.Эффект",LVCFMT_LEFT,100);
			plist->InsertColumn(4,L"П.Эк.эффект, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(5,L"П.Затраты, тыс.руб",LVCFMT_LEFT,100);
			plist->InsertColumn(6,L"П.Общий эк.эффект, тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(7,L"П.Общие затраты, тыс.руб",LVCFMT_LEFT,150);
		}
		if(db.m_iStatus==FACT)
		{
			plist->InsertColumn(2,L"Е.И.",LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"Ф.Эффект",LVCFMT_LEFT,150);
			plist->InsertColumn(4,L"Ф.Эк.эффект,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(5,L"Ф.Затраты,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(6,L"Ф.Время.о.п.,ч",LVCFMT_LEFT,150);
		}
		break;
	case 33:
		plist->InsertColumn(0,L"№п/п",LVCFMT_LEFT,50);
		plist->InsertColumn(1,L"Наименование объекта внедрения",LVCFMT_LEFT,200);
		if(db.m_iStatus==FACT)
		{
			plist->InsertColumn(2,L"Е.И."				,LVCFMT_LEFT,100);
			plist->InsertColumn(3,L"Ф.Эффект"			,LVCFMT_LEFT,150);
			plist->InsertColumn(4,L"Ф.Эк.эффект,тыс.руб",LVCFMT_LEFT,150);
			plist->InsertColumn(5,L"Ф.Затраты,тыс.руб"	,LVCFMT_LEFT,150);
			plist->InsertColumn(6,L"Ф.Время.о.п.,ч"		,LVCFMT_LEFT,150);
		}
		break;
	default:
		break;
	}
	return false;
}


void CMFCApplication30View::SetReportItems(void)
{

}


void CMFCApplication30View::OnInitialUpdate()
{
	CView::OnInitialUpdate();

	// TODO: добавьте специализированный код или вызов базового класса
}

int	CMFCApplication30View::defineQuart(void)
{
	int quart=0;

	if(StrCmp(db.m_szQuart,L"I КВАРТАЛ")==0)
	{
		quart = 1;
	}
	else
	if(StrCmp(db.m_szQuart,L"II КВАРТАЛ")==0)
	{
		quart = 2;
	}
	else
	if(StrCmp(db.m_szQuart,L"III КВАРТАЛ")==0)
	{
		quart = 3;
	}
	else
	if(StrCmp(db.m_szQuart,L"IV КВАРТАЛ")==0)
	{
		quart = 4;
	}
	return quart;
}

int CMFCApplication30View::defineMonth(void)
{
	int m=0;
	
	if(StrCmp(db.m_szMonth,L"ЯНВАРЬ")==0)
	{
		m = 1;
	}
	else
	if(StrCmp(db.m_szMonth,L"ФЕВРАЛЬ")==0)
	{
		m = 2;
	}
	else
	if(StrCmp(db.m_szMonth,L"МАРТ")==0)
	{
		m = 3;
	}
	else
	if(StrCmp(db.m_szMonth,L"АПРЕЛЬ")==0)
	{
		m = 4;
	}
	else
	if(StrCmp(db.m_szMonth,L"МАЙ")==0)
	{
		m = 5;
	}
	else
	if(StrCmp(db.m_szMonth,L"ИЮНЬ")==0)
	{
		m = 6;
	}
	else
	if(StrCmp(db.m_szMonth,L"ИЮЛЬ")==0)
	{
		m = 7;
	}
	else
	if(StrCmp(db.m_szMonth,L"АВГУСТ")==0)
	{
		m = 8;
	}
	else
	if(StrCmp(db.m_szMonth,L"СЕНТЯБРЬ")==0)
	{
		m = 9;
	}
	else
	if(StrCmp(db.m_szMonth,L"ОКТЯБРЬ")==0)
	{
		m = 10;
	}
	else
	if(StrCmp(db.m_szMonth,L"НОЯБРЬ")==0)
	{
		m = 11;
	}
	else
	if(StrCmp(db.m_szMonth,L"ДЕКАБРЬ")==0)
	{
		m = 12;
	}
	return m;
}

bool CMFCApplication30View::FillTable11(CString Query, int iRow, CGenList* cgl)
{
	CRetQuery crq;

	CString buf;

	db.fQueryRead(Query,crq);

	//for(int i=0;i<13;i++)
//	{
//		AfxMessageBox(crq.m_RetValues[0][i]);
//	}

	double dRes;

	if(_wtof(crq.m_RetValues[0][0])==0)
	{
		cgl->GetListCtrl().SetItemText(iRow,3,L"-");
	}
	else
	{
		dRes=_wtof(crq.m_RetValues[0][1])/_wtof(crq.m_RetValues[0][0])*100;
		buf.Format(L"%.0f",dRes);
		cgl->GetListCtrl().SetItemText(iRow,3,buf);
	}
	//PCOST==0
	if(_wtof(crq.m_RetValues[0][3])==0)
	{
		cgl->GetListCtrl().SetItemText(iRow,4,L"-");
	}
	else
	{
		dRes=_wtof(crq.m_RetValues[0][4])/_wtof(crq.m_RetValues[0][3])*100;
		buf.Format(L"%.0f",dRes);
		cgl->GetListCtrl().SetItemText(iRow,4,buf);
	}
	//TOTALPLANECONOMY==0
	if(_wtof(crq.m_RetValues[0][7])==0)
	{
		cgl->GetListCtrl().SetItemText(iRow,13,L"-");
	}
	else
	{
		dRes=_wtof(crq.m_RetValues[0][8])/_wtof(crq.m_RetValues[0][7])*100;
		buf.Format(L"%.0f",dRes);
		//AfxMessageBox(buf);
		cgl->GetListCtrl().SetItemText(iRow,13,buf);
	}
	//TOTALPLANCOST==0
	if(_wtof(crq.m_RetValues[0][9])==0)
	{
		cgl->GetListCtrl().SetItemText(iRow,14,L"-");
	}
	else
	{
		dRes=_wtof(crq.m_RetValues[0][10])/_wtof(crq.m_RetValues[0][9])*100;
		buf.Format(L"%.0f",dRes);
		cgl->GetListCtrl().SetItemText(iRow,14,buf);
	}
	//TOTALPLANTIME==0
	if(_wtof(crq.m_RetValues[0][11])==0)
	{
		cgl->GetListCtrl().SetItemText(iRow,15,L"-");
	}
	else
	{
		dRes=_wtof(crq.m_RetValues[0][12])/_wtof(crq.m_RetValues[0][11])*100;
		buf.Format(L"%.0f",dRes);
		cgl->GetListCtrl().SetItemText(iRow,15,buf);
	}

	//cgl->GetListCtrl().SetItemText(iRow,3,crq.m_RetValues[0][2]);

	for(int i=5;i<13;i++)
	{
		cgl->GetListCtrl().SetItemText(iRow,i,crq.m_RetValues[0][i-5]);
	}

	for(int i=15;i<21;i++)
	{
		cgl->GetListCtrl().SetItemText(iRow,i,crq.m_RetValues[0][i-8]);
	}

	for (int i = 0; i < crq.m_lRecCount; i++)	
	{
		delete [] crq.m_RetValues[i];
	}
	if(crq.m_lRecCount>0)
	delete [] crq.m_RetValues;

	return false;
}
